7장. 보안 구조를 알아보자
---
### 73. 보안의 기본과 개념
#### - 정보 보안 3요소 - CIA
> 1. Confidentiality (기밀성) : 적법한 사람만 정보를 이용할 수 있는 것.
> 2. Integrety (무결성) : 정보를 훼손없이 보존하는 것.
> 3. Availability (가용성) : 정보를 언제나 이용 가능하게 유지하는 것.<br>

*➡️ 이 세가지 요소는 trade-off 관계여서 적절한 밸런스를 유지해야 한다.*

#### - 정보 보안 검토 절차
1. 정보 자산 결정<br>
   : 구체적으로 지켜야 하는 대상을 정한다. <br> ex) 전화번호, 하드웨어, DB...
   
3. 해당 정보 자산에 대한 **위험과 위협** 파악 <br>
   ex) 위험은 정보 누설, 테러 등 / 위협은 멀웨어, 피싱 등
   
5. 위협에 대한 대응 방안 마련

### 멀웨어/컴퓨터 바이러스
#### - 멀웨어의 종류
1. 컴퓨터 바이러스 <br>
  정식 소프트웨어나 기존 프로그램 감염시킨다. 자기 전염 기능, 잠복 기간 있음

2. 웜<br>
  네트워크로 침입하여 자기 자신을 복제하여 컴퓨터를 공격

4. 트로이 목마<br>
  정상 소프트웨어로 위장하여 침입하여 컴퓨터를 공격. 자기 전염 기능은 없음

5. 스파이웨어<br>
   키보드, 마우스 조작 기록을 외부로 유출

#### - 멀웨어의 기능 별 종류
다운로더, 키로거, 랜섬웨어, RAT, 백도어, 루트킷, 익스플로잇 등이 있다.


### 75. 암호화 기술
#### - 암호화란
> - 암호화 : 어떤 데이터를 해독할 수 없는 상태로 변환하는 것
> - 암호 알고리즘 : 암호화를 할 때 사용하는 계산 방법<br>
>          ex) 공통키 암호화 방식, 공개키 암호화 방식, 해시 함수
> - 키 : 알고리즘 계산에 필요한 값

#### - 해시 함수를 사용한 암호화
> 암호화에 사용하는 키는 없고, 평문을 해시 함수로 처리하여 나온 해시 값을 암호문으로 사용하는 방식.

##### 해시 함수의 특징
1. 가변 길이의 데이터를 고정 길이의 해시 값으로 변환한다.
2. 평문과 해시 값은 일대일로 대응된다.
3. 동일한 평문에 대해서는 동일한 해시값이 나오지만, 원본이 조금만 달라져도 완전히 다른 해시 값을 반환한다.
4. 해시 값을 역계산해서 원본을 되돌리는 것은 불가능에 가깝다.

##### 참고) 해시 함수 해킹
슈퍼 컴퓨터나 양자 컴퓨터로 lookup table 만들어서 비밀번호 추론하면 길게는 몇시간만에 뚫린다. 그래서 요즘엔 원본 데이터에 **소금**이나 **후추**를 뿌린다. 

### 76. 공통키 암호화 방식/공개키 암호화 방식
#### - 공통키 암호화 방식
> 보내는 사람과 받는 사람이 동일한 공통키를 갖고 있고, 공통키로 암호화와 복호화를 하는 방식

➡️ 공통키로 암호화와 복호화를 둘 다 진행하기 때문에, 공통키가 유출되지 않도록 양측은 비밀리에 교환해야 한다.

#### - 공개키 암호화 방식
> 보내는 사람과 받는 사람이 각자의 공개키와 개인키를 한쌍 씩 갖고 있고 암호화엔 공개키, 복호화엔 개인키를 사용하는 방식

➡️ 암호화 한 데이터는 그에 대응하는 개인키로만 복호화할 수 있으므로 네트워크로 공개키를 전송해도 괜찮다.

#### - 전자 서명의 원리
공개키 암호화 방식을 역이용한 것이 전자 서명(디지털 서명)이다.

- 절차
>1. 보내는 사람은 원본을 자신의 개인키로 암호화한다. 이것이 디지털 서명이다.
>2. 보내는 사람은 받는 사람에게 원본 데이터, 공개키, 디지털 서명을 보낸다.
>3. 받는 사람은 받은 디지털 서명을 받은 공개키로 복호화한다.
>4. 복호화한 결과가 받은 원본 데이터와 일치한다면 이 디지털 서명은 보내는 사람의 개인키로 암호화된 것임을 나타내므로, 보내는 사람이 서명한 것임을 증명할 수 있게 된다. 

### 77. 서버 인증서/인증 기관
> ##### - 서버 인증서
> 웹사이트가 위조되거나, 위협이 될만한 곳이 아님을 인증하는 인증서이다. 인증 기관에서 발행한다. <br>최근엔 HTTPS 통신이 의무화가 되면서 모든 웹사이트는 모든 서비스에서 필수적으로 서버 인증서를 발급해야 한다.
> ##### - 서버 인증기관
> 웹사이트 개발자는 사전에 서버 정보를 인증 기관에 등록해야 한다. 인증 기관에서 검증 절차가 끝나면 웹사이트는 서버 인증서와 함께 공개키-개인키 한 쌍을 발급받는다.<br>
> ex) Let's encrypt

### 78. SSL/TLS
#### - SSL/TLS
SSL은 HTTPS 프로토콜에서 암호화를 위해 웹 브라우저 'Netscape Navigator'의 개발사가 고안한 프로토콜이다.
이후 표준화 단체인 IETF에서 표준화 하여 TLS를 설계했다.
SSL은 3.1 버전에서 보안 취약성이 발견되어 폐지되고 현재는 TLS가 표준이다.

#### - HTTPS의 인증 과정 (SSL/TLS)
https://www.notion.so/TIL-29040e8dd9394839b8236851e8dc0747?pvs=4#b1bb59c130274400949a222d33fb10fe
1. 클라이언트, 서버, 인증 기관(CA)가 있다.
2. 서버가 인증 기관에게 서버 정보와 서버 공개키를 보낸다.
3. 인증 기관은 서버 정보와 서버 공개키를 CA 개인키로 암호화한다. (SSL 인증서)
4. 인증 기관이 서버에게 SSL 인증서를 전송한다.
5. 서버는 SSL 인증서를 갖고 있다.
6. 인증 기관은 클라이언트에게 CA 공개키를 전송한다.
7. 클라이언트가 서버에게 요청하면, 서버는 클라이언트에게 SSL 인증서를 보낸다.
8. 클라이언트는 SSL 인증서를 CA 공개키로 복호화한다.
9. 클라이언트는 사이트 정보와 서버 공개키를 갖게 된다.
10. 클라이언트가 사이트 정보를 바탕으로 인증 기관에게 검증된 사이트인지? 확인한다.
11. 확인이 되면 클라이언트는 대칭키를 생성하고, 대칭키를 서버 공개키로 암호화하여 서버에게 보낸다.
12. 서버는 서버 개인키로 복호화하여 대칭키를 얻는다.
13. 이 대칭키를 통해 보안 통신을 한다.

![network 2023년 12월 7일](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/601ca658-a0fa-47de-9ff2-393bb9321259)



### 79. 방화벽
> 에지 라우터 바로 뒤에 설치되는 보안 기기. (라우터에 방화벽 기능이 탑재된 제품도 있다.)

방화벽은 패킷의 IP 주소, 포트 번호, 패킷 내용을 확인하여 LAN 내부로 통과시킬지 여부를 결정한다.

#### - 방화벽 종류
- 패킷 필터링형 : IP 주소나 포트 번호를 기준으로 통과 여부를 결정
  - 스태틱형: 차단할 IP 주소와 포트 번호를 리스트로 고정해놓고 관리하는 방식
  - 다이내믹형: 특정 통신에 대한 응답이면 허용하는 방식(동적 리스트)
  - 스테이트풀형: 패킷 뿐만아니라 프로토콜 순서도 감시
- 게이트웨이형(프록시형) : 방화벽이 게이트웨이 역할을 하며 모든 통신을 제어한다.

#### - GFW(Great Firewall)
국가 수준의 방화벽을 정부가 관리하는 체계. ex) 중국, 러시아...

### 80. DMZ
>DMZ : 보안 상의 이유로 방화벽으로 격리된 네트워크 상의 세그먼트. 주로 웹 서버 등을 배치한다.

에지 라우터보다 안쪽에 웹 서버를 두게 되는데, 해당 웹 서버가 위치한 세그먼트는 방화벽으로 격리해서 보호한다. 

DMZ 전후로 방화벽을 하나씩 두기도 하는데, 방화벽이 두 개라서 액세스 제어가 좀 더 수월하다.

방화벽 등의 네트워크 장비는 패킷을 읽어야 하므로 내부엔 서버 OS가 작동한다.

### 81. IDS/IPS
> - IDS: 부정한 패킷의 침입을 탐지
> - IPS: 부정한 패킷을 탐지, 방지

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/e917a2df-0d73-46ff-beb2-d87d469e9d70)

#### - IDS/IPD의 설치 장소에 따른 분류
- 호스트형 : 서버에 소프트웨어로 설치되어 패킷을 검사. 주로 컴퓨터 내부를 감시하는 용도.
- 네트워크형 : 네트워크에 흐르는 패킷을 검사.

#### - 다양한 공격을 방어하는 시스템
- WAF(Web Application Firewall)
  <대비하는 공격 방식>
  - SQL 인젝션 : 웹 서버의 DB에 부정한 문자열을 삽입해 DB를 공격하는 방식
  - XSS : 웹 사이즈에 script 태그를 넣어, 방문하는 사용자의 컴퓨터에서 실행되게 하는 방식
  - CSRF : XSS를 응용해서 방문하는 사용자가 부정한 URL을 열게 하는 공격 방식
- UTM : IDS, 안티바이러스, 로그 감시 등 여러 기능을 방화벽에 통합한 시스템

### 82. VPN/터널
#### - VPN
Virtual Private Network => 가상의 프라이빗 네트웍(=LAN)

> 민희가 재택근무를 하게 됐다고 하자.
><br>
> 집에 있는 컴퓨터로는 사내 LAN 에지에 설치된 방화벽에 막혀 사내 네트워크의 서버에 접속할 수가 없다.
><br>
> 이럴 때, VPN을 구성하여 집에 있는 컴퓨터를 **마치 사내 LAN에 속해있는 것처럼** 설정할 수가 있다.

##### VPN을 통해 사내 네트워크에 접속하는 과정
1. 민희 집 컴퓨터에 VPN 클라이언트를 설치한다.
2. VPN 클라이언트 프로그램은 사내 LAN 라우터와 터널*을 생성하고, 사내 LAN의 네트워크 주소와 같은 대역을 가진 IP 주소를 민희 집 컴퓨터에게 추가로 부여한다.<br>
  ➡️ 이로써 민희 집 컴퓨터는 IP 주소를 두개를 갖고있다!<br>
   기존 IP 주소는 outer라고 하고, VPN으로부터 새로 받은 IP 주소를 original이라고 하자.
3. 민희 집 컴퓨터에서 패킷에 IP 헤더를 붙여 보낸다.<br>
  ➡️ VPN에 의해 새로 발급받은 TCP/IP 헤더가 먼저 붙게 된다.<br>
   여기엔 '출발지: original IP 주소, 도착지: 사내 LAN 서버 IP 주소'가 들어있다.
5. 그 후 '출발지: outer IP 주소, 도착지: 사내 LAN의 라우터 IP 주소'를 가진 헤더가 한번 더 붙는다. (캡슐화) <br>
    => 책에서 말하는 '터널: 본래 프로토콜의 패킷을 그대로 다른 프로토콜의 패킷에 실어 전송하는 기술'
6. 터널을 통해 패킷이 이동한다. (이 패킷은 outer 헤더를 제외한 페이로드는 암호화 되어있다.)
7. 사내 라우터에 도착했다.
8. 사내 라우터 : (outer IP 주소 확인) 어? 얘 나랑 터널 만들었는데. Decapsulation 해야겠다.
9. outer 헤더를 까면 original IP 주소를 확인할 수 있다.

#### - 터널과 VPN 프로토콜
이 VPN 기술에서 패킷이 암호화되어 네트워크 상에는 공개되지 않기 때문에, 터널이라고 한다.

VPN 프로토콜에는 IPsec(패킷 암호화), SSL-VPN(HTTPS를 사용해 패킷 암호화 및 터널링) 등이 있다. 

### 83. 트래픽/로그 감시
#### - 필요성
네트워크 상태를 항상 파악해두어야 평소에 다른 이상이 발생했을 때 인지할 수 있기 때문에, 네트워크 상태를 항상 감시하고 검증하는 것이 중요하다.

#### - 예시
1. 평소 발생하지 않는 해외 접속이나 통신 등이 있는지 확인한다.
2. 서버의 이벤트 로그(API 호출, 프로세스 메시지, 경고, 오류 등의 이력 데이터)를 확인하여 수상한 통신, 중요 데이터에 대한 액세스, 로그인 오류가 있는지 항시 감시한다.

#### - 방법
- 트래픽 감시의 경우,<br>
  차세대 방화벽이나 패킷 캡처 기능*이 있는 네트워크 기기를 이용해 네트워크에 흐르는 패킷을 실시간 체크한다.
- 로그 감시의 경우,<br>
  서버의 로그 파일을 소프트웨어로 분석하는데 로그 파일에 공격, 이상 등의 흔적을 체크한다. 최근엔 통계학적 분석 방법을 활용하거나 AI를 이용하여 분석하는 경우가 늘어나고 있다.

* 패킷 캡처 기능 : 네트워크에 흐르고 있는 패킷을 캡처하여 내용 시각화, 분석, 집계 등을 수행하는 기능 
