# 보안 구조를 알아보자

## 1. 보안의 기본과 개념 - 자신을 보호하는 데 필요한 것

### 정보 보안의 CIA 밸런스

- 정보 보안

  - 기밀성(Confidentiality): 적법한 사람만 정보를 이용할 수 있도록 보호 및 관리되는 것
  - 무결성(Integrity): 변경이나 파괴없이 정보가 올바른 상태로 유지되는 것
  - 가용성(Availability): 올바른 정보들이 적절하게 이용 가능한 상태에 있는 것

- 기밀성과 무결성은 가용성과 상충한다
- CIA의 우선순위는 원칙적으로 없고 상황, 용도, 목적 등에 따라 달라지며 각각의 밸런스가 중요하다

### 정보 보안을 검토하는 절차

    1. '개인이나 조직에서 지켜야 할 가치가 있는 것은 무엇인가' 고려 - 보호할 정보자산을 구체적으로 결정
    2. 그 정보 자산이 가지는 위험과 위협을 파악 - 자연재해나 정보 유출, 법 개정 등 위험에 대해 어떤 위협(지진, 해킹, 악성 코드 등)이 있는 지 나열
    3. 나열한 위협에 대해 어떻게 대응할지(하지 않을지) 검토 - 기술적인 대책이나 조직적인 규칙 등

#### 용어 노트

- 정보 보안: 기업이나 조직이 보호해야 할 정보 자산(종이나 전자 데이터)을 리스트업하고, 그 우선도나 관리 방침 등을 정해서 필요한 대책이나 처치 등을 실시한다.
- 정보 자산: 고객 정보나 직원 정보, 재무 정보 등 기업이나 조직의 활동에서 가치가 있는 정보, 종이, 전자 데이터 등 기록 매체는 상관없다.

#### 위험과 위협의 예

| 구분 | 의미                                    | 예                                                         |
| ---- | --------------------------------------- | ---------------------------------------------------------- |
| 위험 | 업무나 자산에 손해나 피해를 초래하는 것 | 정보누설, 내부 범행, 사고,재해,테러, 법 개정, 신용 훼손 등 |
| 위협 | 위험을 일으키는 구체적인 요인이나 사건  | 사이버 공격, 멀웨어, 랜섬웨어, 피싱, 표적형 공격 등        |

<hr/>

## 2. 멀웨어/컴퓨터 바이러스 - 악영향을 미치는 소프트웨어나 프로그램

### 악영향을 미치는 멀웨어 종류

- 멀웨어: 모든 악의적인 소프트웨어, 프로그램

  - 컴퓨터 바이러스: 단독으로 존재할 수 없고, 기존 프로그램에 기생해서 전염됨
    - 자기 전염 기능, 잠복 기능(공격까지 잠복 기간이 있음), 발병 기능
  - 웜: 내트워크 등을 이용하여 침입하고 독립적으로 전염되며, 다른 프로그램 등 작동에 악영향을 미침
  - 트로이목마: 정상적인 소프트웨어나 프로그램으로 위장하여 침입한 후 다른 프로그램 작동에 악영향을 미침. 원칙적으로 자기 전염 기능x
  - 스파이웨어: 키보드나 마우스 조작, 표시 화면 등을 감시하고 기록해서 외부로 유출시킴. 자기 전염 기능x

#### 용어 노트

- 자기 전염 기능: 다른 프로그램에 자신의 사본을 만들어 전염을 확산시키고 증식해 나가는 기능
- 잠복 기능: 일정 기간이나 처리 횟수 등 조건이 충족될 때까지 동작하지 않는 기능
- 발병 기능: 데이터를 파괴하거나 훔치는 컴퓨터에 실제로 악영향을 미치는 동작을 하게 하는 기능

#### 주요 멀웨어 기능별 분류

| 종류       | 기능                                                                                                                 |
| ---------- | -------------------------------------------------------------------------------------------------------------------- |
| 다운로더   | 공격자 서버에서 멀웨어 본체를 내려받아 감염시키는 프로그램                                                           |
| 키로거     | 컴퓨터의 키 조작을 감시하여 기록하고 외부로 유출시키는 프로그램                                                      |
| 랜섬웨어   | 컴퓨터 내 데이터에 암호를 걸거나 공개 등을 빌미로 삼어 그것을 해체하는 대가로 돈을 요구하는 화면을 표시하는 프로그램 |
| RAT        | 컴퓨터를 원격 조작하거나 데이터를 훔칠 수 있게 하는 프로그램                                                         |
| 백도어     | 컴퓨터에 몰래 침입할 수 있는 뒷문을 만드는 것                                                                        |
| 루트킷     | 다운로더나 키로거 등 침입 및 원격 조작에 필요한 도구를 세트로 만든 것                                                |
| 익스플로잇 | 앱이나 시스템의 취약점을 이용해서 공격하는 프로그램                                                                  |

<hr/>

## 3. 암호화 기술 - 해독 불가능한 상태로 통신하는 기술

### 암호화의 기본 개념

- 암호화: 어떤 방법으로든 데이터를 해독할 수 없는 상태로 변환하는 것
  - 텍스트 데이터는 암호화하면 의미가 없는 문자열로 변환됨 -> 암호화에 사용된 계산 방법을 알고 있다면 복호화 가능
  - 암호화 처리 절차나 계산 방법 - 암호 알고리즘
  - 계산에 사용되는 특정한 부호(수치 데이터) - 키
  - 알고리즘이 알려져 있더라도 키가 없으면 암호화, 복호화 둘 다 불가
  - 암호의 기밀성은 키로 유지됨

### 해시 함수를 사용한 암호화

| 암호화 방식        | 특징                                                                                                                                                             |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 공통키 암호화 방식 | 암호화와 복호화에 같은 키(공통키)를 사용한다. 공통키를 안전한 방법으로 공유할 필요가 있다.                                                                       |
| 공개키 암호화 방식 | 암호화와 복호화에 서로 다른 키(공개키, 개인키)를 사용한다. 공개키는 네트워크에 공개하지만 공개키와 암호문이 있어도 쌍을 이루는 개인키가 없으면 복호화할 수 없다. |
| 해시 함수          | 원래의 데이터(평문)에 대해 일정한 처리를 거친 결과(해시 값)를 출력하는 함수로, 키를 사용하지 않고는 복호화가 불가능하다.                                         |

- 해시함수
  - 평문과 해시값이 일대일로 대응 되는데, 해시 값을 계산하여 평문으로 되돌리는 것이 거의 불가능.
    - 비밀번호 저장이나 데이터 변조 방지 등에도 이용
  - 같은 데이터에서 반드시 같은 해시 값이 출력되므로 입력한 값을 해시함수로 처리한 결과와 등록된 값이 일치하는지 여부로 비밀번호를 검증

#### 용어 노트

- 원래 데이터: 암호화된 데이터를 원래 데이터로 되돌리는 것을 디코딩이라한다. 또 원래의 해독 가능한 데이터를 평문, 암호화된 해독 불가능한 데이터를 암호문이라 한다.

#### 주요 암호 알고리즘의 종류

| 알고리즘 | 암호화 방식        | 특징 및 기능                                                                |
| -------- | ------------------ | --------------------------------------------------------------------------- |
| AES      | 공통키 암호화 방식 | VPN이나 SSL 등 각종 암호화 통신에서 이용                                    |
| RC4      | 공통키 암호화 방식 | Wi-Fi의 WPA2나 SSL에서 이용                                                 |
| RSA      | 공개키 암호화 방식 | HTTPS나 전자 서명등에서 이용                                                |
| DSA      | 공개키 암호화 방식 | 미국 정부용 전자 서명 포준                                                  |
| ECDSA    | 공개키 암호화 방식 | 타원 곡선을 이용한 암호화 방식(타원 곡선 암호)이 채택되어 블록체인에서 이용 |

<hr/>

## 4. 공통키 암호화 방식/공개키 암호화 방식 - 키를 사용하여 암호화, 복호화하는 기술

### 공통키 암호화 방식과 공개키 암호화 방식

- 공통키 암호화 방식: 암호화에 사용하는 키(공통키)를 데이터 송신자와 수신자가 양쪽에서 비밀리에 공유하여 암호화 통신을 수행하는 방식

  - 공통키를 안전하게 공유해야 하는데, 네트워크로 교환할 때 유출될 위험이 있다.

- 공개키 암호화 방식: 암호화와 복호화에 키(공개키,개인키)를 2개 사용하여 암호화 통신을 수행하는 방식
  - 순서
    - 송신자는 수신자가 공유한 공개키를 사용하여 원본 데이터를 암호화한 후 전송
    - 암호화한 데이터는 수신자가 가진 개인키로만 복호화 가능
    - 암호화와 복호화에 사용하는 키가 다르기 때문에 복호화에 사용하는 개인키를 자신만 알고 있으면 네트워크로 공개키를 전송해도 안전
  - 공개키를 네트워크상에서 공유할 수 있으므로 HTTPS통신, VPN 통신의 네고시에이션, 키 교환, 전자 서명등에 이용됨

### 공개키 암호화 방식을 역으로 사용한 전자서명

- 순서

  - 키 생성: 서명자(전자 서명을 생성하는 주체)는 공개키와 개인키를 생성합니다. 공개키는 다른 사용자에게 공개되며, 개인키는 안전하게 보호되어야 합니다.

  - 서명 생성: 서명자는 전자 서명을 생성하려는 데이터에 대한 해시값을 계산합니다. 그런 다음, 서명자는 개인키를 사용하여 이 해시값을 암호화하여 전자 서명을 생성합니다.

  - 전자 서명 첨부: 생성된 전자 서명은 원본 데이터와 함께 전송되거나 저장됩니다.

  - 전송 또는 저장: 원본 데이터와 함께 전자 서명을 안전한 방법으로 전송하거나 저장합니다.

  - 서명 확인: 데이터를 수신한 사람은 송신자의 공개키를 사용하여 전자 서명을 복호화하여 해시값을 얻습니다.
    그리고 나서 수신한 데이터에 대한 해시값을 다시 계산합니다. 두 해시값이 일치한다면, 이는 전자 서명이 유효하다는 것을 의미합니다.

- 이 부분에서 공개키가 위조되지 않은 송신자 것임을 증명돼야 한다. 이 역할은 인증기관이 담당한다.

#### 용어 노트

- 위조: 계정 정보, IP주소, URL, 전자 서명 등을 가장해서 특정 사용자 및 호스트를 사칭한다.
  공개키 소유자가 위조되었다면 확인할 수단이 없다. 공개키가 정당한 소유자인지 아닌지 인증기관의 증명이 필요해진다.

<hr/>

## 5. 서버 인증서/인증기관 - 접속할 곳의 정당성을 증명하는 구조

    공개키 암호화 방식을 사용하면 접속한 곳이 위장된 웹 페이자나 공격자의 웹페이지가 아닌 것도 증명할 수 있습니다.
    이 증명에는 서버 인증서가 이용되며, 이 인증서를 발급하는 것이 인증기관입니다.

### 서버 인증서

- 공개키 암호화 방식을 이용한 전자 서명을 통해 인증기관(CA)이 본인임을 인증해 주는 인터넷상의 체계
  - HTTPS 통신에선 패킷을 암호화하기 전에 접속한 곳에서 서버 인증서를 받아 정당성을 검증
  - 정당한 웹페이지면 연결되는 곳의 웹 서버와 암호화 방식이나 키 정보를 교환하고 암호화 통신을 시작

### 인증 기관

- HTTPS 통신 등에서 서버 인증서를 발급하고, 접속하는 웹 서비스 적법성을 인증하는 기관(서버 인증서는 **인증 기관 서버**에서 발급된다)
- 기업의 인증 기관 등록(HTTPS 통신을 위한)
  - 인증기관은 기업의 등기부 확인 or 대면이나 전화로 실존하는 기업인지 확인하여 웹사이트 인증 과정을 거침
  - 웹사이트에는 서버인증서와 함께 공개키 암호화 방식의 개인키와 공개키 쌍이 발급된다.
- HTTPS 통신
  - 웹 브라우저가 HTTPS통신 요청을 하면 웹 서버는 서버 인증서와 공개키를 반환
  - 웹 브라우저는 서버 인증서를 인증 기관에 확인

#### 용어 노트

- 인증 기관 서버: 인증 기관이 운영하는 서버. 공개키가 정당한지 등록정보와 대조해서 인증한다.

<hr/>

## 6. SSL/TLS - 암호화 통신 프로토콜

    SSL/TLS는 암호화 통신을 수행하는 절차를 규정하는 프로토콜입니다.
    공개키 암호화 방식을 이용하여 연결 대상의 정당성을 확인한 후 암호화 통신에 필요한 키를 생성하고, 패킷 암호화와 복호화를 실행합니다

### SSL을 개량해서 TLS를 설계

- SSL
  - 웹 브라우저 개발사에서 만듦
  - HTTPS 프로토콜에 암호화를 위한 상세한 절차를 규정하지 않아 SSL사용
  - IETF가 TLS로 다시 설계해서 인터넷 표준으로 삼음
- 둘 사이에 엄격한 호환성x
- 현재는 TLS 1.2와 TLS1.3이 정식 프로토콜

### TLS를 이용한 암호화 통신

- 공개키 암호화 방식을 이용
  - 순서
    - 웹 브라우저는 웹 서비스에서 서버 인증서와 공개키를 받아 인증서를 검증
    - 웹 브라우저는 받은 공개키로 암호화 통신용 키 생성에 필요한 정보(난수)를 암호화해서 웹 서버에 보냄
    - 웹 서버는 그 난수를 개인키로 복호화하여 암호화 통신용 키를 생성(이 방법으로 키 자체를 네트워크 통신을 안하면서 암호화 통신용 키를 공유)
    - 키 공유하면 암호화 통신 실시 -> 이후 웹 브라우저와 서버 사이에서 주고받는 데이터는 암호화되어 네트워크상의 기기로 사칭이나 도청, 변조 등을 막을 수 있다

<hr/>

## 7. 방화벽 - 외부에서 오는 공격을 제어하는 구조

- 네트워크 세그먼트 경계에 설치되는 게이트웨이의 일종
- 인터넷과 LAN의 경계인 에지 라우터 바로 뒤(내부)에 설치
- 기능

  - 패킷의 종류와 내용을 확인하여 LAN 내부로 통과시킬지 여부를 결정
  - 라우터는 패킷의 IP주소를 확인해서 자신이 관리하는 LAN으로 전송되는지 여부를 기준
  - 방확벽은 패킷의 IP주소, 포트 번호, 패킷 내용 정보를 확인해서 통과 여부를 제어함
  - 실제 라우터에는 방화벽 기능이 탑재된 제품도 있다.

- 종류(패킷을 체크하는 정도/방법)
  - 패킷 필터링형: IP 주소나 포트 번호를 기준으로 통과시킬 패킷을 제어
    - 스태틱형: 차단 or 통과시킬 IP주소나 포트 번호를 고정리스트로 관리하는 방식
    - 다이내믹형: 특정 통신에 대한 응답이면 허용하는 등 동적인 리스트로 관리
    - 스테이트풀형: 패킷 단독이 아니라 프로토콜 순서도 감시하여 부정한 액세스를 차단
  - 게이트웨이형: 네트워크의 게이트웨어로서 모든 통신을 제어(네트워크 내부와 외부 모두 방화벽이 창구 역할을 하기 때문에 **프록시형**이라고도 함)

#### 프록시형

    프록시란 인터넷과 LAN경계에서 패킷 출입을 대행해서 처리하는 기능을 의미.
    패킷 제어나 액세스 부하의 분산, 보안 대책 등으로 프록시 서버를 경유시킬 때가 있다

<hr/>

## 8. DMZ - 내부 내트워크와 분리시킨 세그먼트

### 공개 서버와 내부 네트워크 보호

- 내부 네트워크를 외부 공격에서 보호하려고 방화벽 등으로 격리된 네트워크상의 세그먼트
  - 설치: 일반적으로 외부에 공개하는 웹 서버나 메일 서버 등을 배치

### 라우터 등을 활용한 DMZ의 다양화

- 실제 네트워크에서는 DMZ를 앞뒤로 방화벽을 배치하기도 함
- 라우터, 게이트웨이, 방화벽은 네트워크 장비로서 개별 하드웨어로 되어 있을 때가 많지만, 이들 장바의 내부는 서버(컴퓨터)와 차이가 없다
- 네트워크 장비는 패킷을 읽어야 하므로 내부에서는 서버OS가 작동하며, 애플리케이션기능으로 라우팅이나 필터링 등을 한다

<hr/>

## 9. IDS/IPS - 내부 네트워크로 침입을 탐지하는 시스템

### 부정한 패킷의 침입을 탐지하는 IDS와 IPS

- 공격자 수법이 고도화 되면서 입구만 강화해서는 침입을 막을 수 없게 돼서 부정한 패킷을 통과한 후 내부에서 침입을 탐지하고 제거하는 시스템.
  - IDS(Intrusion Detection System): 부정한 패킷의 침입을 탐지하는 시스템
  - IPS(Intrusion Prevention System): 부정한 패킷을 탐지하여 방지하는 시스템
  - 탐지 방법: IP주소나 포트 번호뿐만 아니라 프로토콜 순서와 처리 상황 등도 검증한다.
  - 설치 장소(2가지로 나뉨)
    - 호스트형: 서버에 소프트웨어로 설치되어 부정한 패킷 검사
    - 네트워크형: 네트워크상에서 흐르는 패킷 감시

### 다양한 공격을 방어하는 시스템

- 차세대 방화벽(NGFW): IDS, IPS, 고기능 방화벽
  - 패킷 내용, 프로토콜 순서, 처리상황, 앱별 패킷 동작 등 IP주소나 포트번호 등 다양한 요소로 검증
- UTM(Unified Threat Management): WAF(Web Application Firewall), IDS, 안티바이러스, 로그 감시 등 여러 기능을 방화벽에 통합한 시스템

#### 용어 노트

- 방어 정책: 방화벽 등 보안 제품의 설정 방침을 의미
- SQL 인젝션: 데이터베이스를 이용하는 웹사이트에 대해 예상되지 않는 문자열 등을 삽입시켜 부정한 조작을 공격하는 수법
- XSS(Cross Site Scripting): 공격자가 표적으로 하는 웹 사이트에 간이 프로그램을 설치하여 방문자의 컴퓨터에서 부정하게 실행시키는 공격수법
- CSRF(Cross-Site Request Forgeries): 공격자가 방문자에게 위조된 URL을 열게하여 표시된 웹 사이트에서 뭔가 조작을 하도록 하는 공격기법

<hr/>

## 10. VPN/터널 - 네트워크 내 가상의 전용선을 구축하는 기술

    일반에 공개되어 불특정 다수와 연결되는 네트워크에 특정 상대만 이용할 수 있는 전용선을 가상으로 구축하는 기술

- 호스트(일반적으로 라우터)를 VPN으로 연결하면 연결대상과 교환하는 패킷이 암호화

  - 여러 라우터를 거쳐 연결대상에 도달하지만 중계하는 라우터는 패킷 내용을 해독할 수 없으므로 경로는 보호된 상태 => 이런 기술을 **터널**이라 한다.

- 터널
  - 본래 프로토콜의 패킷을 그대로 다른 프로토콜의 패킷에 실어 전송하는 기술(경로 암호화는 필수x)
  - 경로 내에 다른 프로토콜의 네트워크가 있을 때는 패킷을 원활하게 전달할 수 있는 터널을 사용하는 것이 유용하다 -> 이런 처리를 **캡슐화**라고도 한다

### 암호화와 터널을 구현하는 VPN 프로토콜

- VPN의 대표적인 프로토콜 4가지
  - IPsec: 연결 대상의 인증 기능과 패킷의 암호화 기능을 갖춘 프로토콜(인터넷 표준)
  - L2TP: 패킷 암호화는 하지 않고 터널로 연결 대상과 전용 경로를 구축하는 프로토콜
  - PPTP: 윈도에서 표준으로 사용되던 프로토콜
  - SSL-VPN: SSL(세션 계층 프로토콜 - 5계층)을 사용하므로 웹 브라우저 연결을 VPN으로 사용하고자 할 때 이용. HTTPS를 사용해서 암호화와 터널을 구현

#### 용어 노트

- L2TP: 암호화가 필요할 때는 L2TP와 IPsec을 조합하는 경우가 많다.

<hr/>

## 11. 트래픽 감시/로그 감시 - 네트워크 이상을 검출하는 방법

- 보안을 높은 수준으로 유지하려면 네트워크 상태를 항상 감시하고 검증하는 것이 중요하다
  - Why?
    - 언제 발생한 문제인지 알기 위해
    - 다양해지는 공격 기술때문
  - 네트워크에서 수상한 동작을 검출하려면 네트워크 트래픽을 감시해야한다.
    - Which?
      - 평소 발생하지 않는 해외 접속이나 통신 등 확인
      - 서버의 이벤트 로그를 확인하여 수상한 통신, 중요 데이터에 대한 액세스나 로그인 오류 등이 있는지 확인

### 트래픽 감시와 로그 감시 방법

- 트래픽 감시

  - 차세대 방화벽과 같은 고기능인 제품이나 패킷 캡처 기능이 있는 네트워크 기기 이용
    - 네트워크를 흐르는 패킷을 상시체크 가능

- 로그 감시
  - 서버의 로그 파일을 소프트웨어로 해석
    - 로그 파일에 남아있는 공격이나 이상 등 흔적을 체크하여 이상이 발생하지 않았는지 조사
    - 로그 감시는 과거 발생 상황을 조사하게 된다.

#### 용어 노트

- 정상 사용자로 위장하는 침입: 위장 메일 등으로 개인정보를 입수하는 피싱이나 고객 등을 가장하여 특정 표적에서 정보를 취득하는 표적형 공격 등으로 계정정보를 입수하는 수법이 늘고 있다.
- 이벤트로그: 컴퓨터나 서버 등에서 발생한 API 호출, 프로세스 메시지, 경고, 오류, 조작이력 등을 시계열로 기록한 데이터
- 패킷 챕처 기능: 네트워크에 흐르는 패킷을 캡처하여 그 내용을 표시(시각화)하거나 분석, 집계 등을 수행하는 기능
