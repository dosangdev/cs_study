# 인터넷 구조를 알아보자

## 1. 인터넷 구조 - 네트워크끼리 연결하는 광범위한 네트워크

    인터넷: 기업이나 조직의 LAN, 웹이나 클라우드 사업자, ISP, 모바일 네트워크 등을 연결하는 광범위한 네트워크이다.

### 인터넷 기원

    인터넷이라는 용어는 1980년대 후반부터 사용되었고, 네트워크끼리 서로 대등한 관계로 연결하고 있었기 때문에 네트워크 사이를 연결한다는 의미에서 internet으로 불렀습니다.

### 네트워크를 연결하는 인터넷 구조

인터넷에서는 전 세계 LAN이나 ISP, 모바일 네트워크를 연결하는 데 라우터를 이용합니다

- 라우터의 기본 기능

  - LAN의 내부의 통신은 외부로 내보내지 않는다
  - 자신의 LAN 주소가 아닌 통신은 내부로 들여보내지 않는다
  - 자신의 LAN 주소가 아닌 통신은 라우팅 테이블이나 기본 게이트웨이를 설정하여 전달된다(이때 IP주소를 자신이나 자신이 관리하는 LAN, 전송대상의 식별자로 사용합니다).

- 인터넷에서는 모든 패킷이 라우터를 이용하여 버킷 릴레이처럼 운반됩니다. 각 라우터는 라우팅 테이블의 범위만큼 연결 정보를 가지고 있는데, 이 기본 기능 덕분에 패킷이 올바른 목적지로 전달됩니다.

<hr/>

## 2. 인터넷에서 사용하는 프로토콜 - 인터넷에서 다양한 기능을 실현하는 규약

### IP 주소를 보고 패킷을 전송하는 TCP/IP

    TCP/IP 프로토콜은 IP 주소를 기반으로 패킷을 전송하는 기능 밖에 없음
    목적지에 패킷이 도달했는지, 재전송할 필요가 있는지 등 확인하는 역할은 애플리케이션이 담당
    --> 그것만으로는 복잡한 기능을 실현하기 어렵다.

### 서비스 프로토콜로 상위 기능 실현

    인터넷에는 라우팅 정보교환, 패킷전달하는 프토토콜 이외에도 다양한 상위 프로토콜과 서비스 프로토콜이 있습니다. 이런 프로토콜은 IP, TCP, UDP 프로토콜을 사용해서 상위 기능을 구현합니다.
    서비스 프로토콜은 다양한 웹 앱, 웹 서비스, 클라우드 서비스 등을 구현하는데 필수적입니다.
    잘 알려진 포트는 서비스 프로토콜에 할당되어 있습니다.
    서비스 프로토콜과 포트 번호는 인터넷 식별자를 관리하는 IANA에서 할당을 관리합니다.
    애플리케이션이나 서비스별로 정해진 포트번호는 RFC에도 명시되어 있습니다.

<hr/>

## 3. 이메일을 주고받는 구조 - SMTP와 POP를 사용한 이메일 수송신

## 이메일 송수신 구조

    SMTP(Simple Mail Transfer Protocol): 이메일 보낼 때 사용하는 프로토콜
    POP(Post Office Protocol): 이메일을 받을 때 사용하는 프로토콜

    이메일 송신 -> 보낸사람의 메일 서버(SMTP) -> SMTP가 수신자의 POP서버로 송신(스풀파일에 저장) -> 수신자는 본인의 이메일에 엑세스할 때 로그인 인증 -> 이메일 내려받음(이메일은 스풀 파일에서 삭제)

- IMAP(Internet Message Access Protocol):
  - 이메일을 수신하는 프로토콜의 하나.
  - 메일 서버 메일함에서 이메일을 관리하고 사용자는 서버에서 이메일을 내려받아 열람한다.
  - IMAP은 서버가 이메일을 관리하므로 스풀파일에서 이메일이 삭제되지 않습니다.

#### POP와 IMAP의 차이

    POP는 이메일을 내려받아 관리하므로 같은 계정이라도 다른 컴퓨터 등에서 볼 수 없다.(스풀파일에서 삭제)
    IMAP은 서버에서 이메일을 관리하므로 같은 계정이라면 모든 컴퓨터에서 이메일을 볼 수 있다.

### 메일 프로토콜의 보안

    메일 프로토콜에는 대부분 보안기능이 구현x. 전송 프로토콜은 수신자의 이메일 주소가 정상이라면 누가했든 정규메일로 처리. 따라서 SMTP나 POP로는 스푸핑이나 스팸 메일을 막을 수 없고, SMTP로 전송하기 전에 발신자 인증이나 암호화 등 프로토콜을 확장하거나 추가합니다. 현재도 완전해진 것은 아님.

    cf. 스푸핑(spoofing)이란, 눈속임(spoof)에서 파생된 IT 용어로, 직접적으로 시스템에 침입을 시도하지 않고 피해자가 공격자의 악의적인 시도에 의한 잘못된 정보, 혹은 연결을 신뢰하게끔 만드는 일련의 기법들을 의미한다. 쉽게 말해서 속임수 혹은 사기죄

<hr/>

## 4. 웹 페이지를 열람할 수 있는 구조 - 웹 서버와 웹 클라이언트의 통신

    인터넷(거대한 네트워크) === 인프라 기술 + 관련 프로토콜

### 웹을 구성하는 인프라 기술

- 웹
  - 네트워크 모델은 클라이언트-서버형, TCP/IP, HTTPS, DNS 등을 인프라 기술로 이용함
  - 웹 서버, 웹 클라이언트, HTML/Javascript/PHP/Java 등 언어 SQL 등 데이터베이스, XML(데이터 구조 및 속성 기술), REST-API 등으로 구성됩니다.(이에 한정x but 웹 서버, 웹 클라이언트는 필수)
  - 인프라 기술은 기업 웹페이지, 온라인 회의 서비스, 동영상 전송 서비스, AWS 등 온갖 기능과 서비스를 제공

### 웹의 기본 구조

    초기 웹은 정보를 열람하는 서비스. 문자, 수식, 그림, 이미지, 동영상이나 음성 등도 통합할 수 있는 데이터 형식으로 HTML 채택.
    웹 - HTML형식의 문서를 웹 서버에 저장 -> 웹 클라이언트가 인터넷을 통해 웹 서버에 액세스 -> 논문 페이지를 화면에 표시
    현재 웹 서버 - Apache, IIS, NGINX 등이 사용
        웹 브라우저 - 구글 크롬, 마이크로소프트 엣지, 사파리, 모질라 등 사용

<hr/>

## 5. URL/URI - 인터넷상의 장소를 특정하는 식별자

### 네트워크상의 장소나 이름을 특정하는 URL

    URL(Uniform Resource Locator): 인터넷상의 서버나 데이터(리소스) 등을 특정하는 방법을 규정한 것.
    URL: 리소스의 보관 위치를 나타냄
    URI(Uniform Resource Identifier): 리소스 위치
    URN(Uniform Resource Name): 리소스 이름
    cf. 리소스: 네트워크 상의 서버나 내부 데이터, 애플리케이션, 기능 등 전반을 리소스라고 한다.

URN과 URL은 URI의 하위 카테고리

ex)

1. URI: mailto:john.doe@example.com: 이것은 이메일 주소를 나타내는 URI입니다. "mailto:"는 이메일을 식별하기 위한 스킴(프로토콜)을 나타냅니다. 이것은 URI의 일반적인 형태 중 하나입니다.
2. URL:https://www.example.com/index.html: 이것은 URL입니다. "https://"는 프로토콜을 나타내고, "www.example.com"은 호스트를 나타내며, "/index.html"은 리소스의 경로를 나타냅니다.
3. URN:urn:isbn:0451450523: 이것은 URN의 일종으로, ISBN을 사용하여 책을 식별합니다. "urn:"은 URN을 나타내고, "isbn:0451450523"은 ISBN을 사용한 고유한 식별자입니다.

### 위치를 지정하는 데 사용되는 URL 구조

    URL은 인터넷상의 위치를 특정합니다. 위치란 어느 네트워크 어느 서버의 특정 파일인가 하는 정보입니다.
    프로토콜에는 HTTP,HTTPS,FILE,DATA 등이 예약어로 등록되어 있습니다.
    cf. 예약어: 개발자가 정의해서 사용할 수 없는 문자열이다. URI 스키마 이름에는 HTTPS, FILE 이외에도 웹 브라우저나 웹 서버, OS별로 고유하게 정의된 것도 있다.

URL의 구성 요소와 의미

- 스키마: 장소에 액세스하는 프로토콜을 지정(https)
- 권한: '//'로 시작하고 장소르 다음요소로 지정
  - 사용자 정보: 사용자 ID 및 계정 등
  - 호스트 정보: 서버의 도메인 이름
  - 포트 정보: 액세스할 포트 번호
- 경로: 서버의 파일 경로를 '/'로 구분하여 지정
- 쿼리: '?' 이후의 문자열을 변수 또는 명령으로 지정. 액티브와 패시브 두 종류의 파라미터가 있습니다.
- 프래크먼트: 서버의 응답이나 부호로서 웹 브라우저가 처리하는 정보입니다. 앵커라고도 함.

![이미지 설명]https://www.beusable.net/blog/wp-content/uploads/2021/02/image-7.png

> URL은 처음부터 listen까지
> URN은 top부터 끝까지
> URI는 전체

- 액티브 파라미터
  https://www.example.com/index.html?color=blue
  여기서 color는 쿼리에 지정된 데이터가 표시하는 웹페이지 내용을 변환되는 내용
  '='는 각 항목 값을 설정하는 부분

- 패시브 파라미터
  https://www.example.com/index.html?utm_source=aaa&***
  utm_source - 쿼리에 지정된 데이터로 표시되는 웹 페이지 내용을 변하지 않고 참조 정보 등을 지정한다.
  '&'로 다수의 파라미터를 부여할 수 있다.

- 구글 애널리틱스의 파라미터의 예
  | 파라미터 | 내용 | 쿼리 기술 방식 |
  | ------------ | ---------------- | ----------------- |
  | utm_source | 매체 종류 | ?utm_source=aaa |
  | utm_medium | 매체 종류 | ?utm_medium===aaa |
  | utm_campaign | 광고 캠페인 이름 | ?utm_campaign===a |
  | utm_content | 광고 콘텐츠 | ?utm_content===a |
  | utm_term | 광고 키워드 | ?utm_term===a |

### HTTP, HTTPS 이외의 스키마

URL을 지정할 때 스키마로 HTTP,HTTPS만 사용됨. FILE을 지정하면 권한 부분의 기술은 웹 브라우저가 동작하는 로컬 호스트가 되고, 경로지정은 해당 컴퓨터의 하드디스크에 있는 파일을 가리킵니다.

<hr/>

## 6. HTTP/HTTPS - 웹에서 사용되는 프로토콜

### 웹에서 통신에 사용되는 HTTP

일반적인 프로세스

1. 웹 브라우저의 요청 -> 웹 서버(이 웹페이지를 표시하고 싶다)
2. 요청받은 서버는 해당하는 HTML파일을 반환
   이런 통신에 쓰이는 것이 HTTP,HTTPS

### 통신 낭비를 줄이는 웹 브라우저 기능

- HTTP는 하위 프로토콜로 TCP를 사용하여 세션을 설정
- 웹 브라우저,서버의 요청과 응답은 매번 독립적으로 처리 --> 스테이트리스
- HTTP 통신이 스테이트리스인 이유
  - 웹 서버가 불특정 다수의 웹 브라우저 요청을 처리하는 동안 접속별로 상태를 유지하기 어렵기 때문입니다.
  - 반면에 같은HTML 파일을 여러 번 전송하는 것은 낭비.
    - 웹브라우저로 해결 가능
      - 캐시기능으로 한번 접속한 웹 페이지 정보를 보관하고 있다 두번째 접속부터는 웹 페이지가 업데이트 되지 않으면
        캐시에 저장된 파일을 사용하여 서버 접속을 회피함.

### 스테이트풀 기능을 실현하는 쿠키

웹브라우저의 스테이트풀 기능

- 마지막으로 방문한 웹 페이지를 기억하거나 로그인 상태를 유지(쿠키라는 작업 파일을 사용자 컴퓨터에 저장)
  - 이외에 과거 방문한 웹페이지의 URL, 타임스탬프, 로그인할 때 생성되는 세션 정보, 과거에 입력한 주소 및 이메일 주소 등 저장

<hr/>

## 7. DNS - 도메인 이름과 IP 주소를 관리하는 구조

    DNS(Domain Name System): 도메인 이름과 IP 주소의 대응표를 관리하는 체계
    DNS서버: 이 대응표 DB를 관리하는 서버(여러 서버에 DB를 분산하여 서로 통신하면서 관리)

### IP 주소를 다루기 쉽게 한 도메인 이름

    사람이 관리하기 힘든 IP주소를 쉬운 이름으로 인터넷에서 관리, 이용할 수 있도록 고안된 것이 도메인 이름.
    대응표를 만들어 관리하는 것이 DNS.
    도메인 이름은 임의의 서버 이름에 조직이름이나 지역, 속성 등 정보를 계층적으로 추가한 것.

### 도메인 이름과 IP 주소 관리 방법

- DNS서버는 여러 서버에 DB를 분산시켜 서로 통신하며 관리.
- DB에선 도메인 이름과 IP주소가 '**영역**'이라는 단위로 관리됨
- 영역 정보를 유지하는 서버를 **권한 DNS 서버** 또는 네임 서버라고 함.
- 클라이언트 IP 주소 문의 ->(LAN 내 DNS서버가 도메인 이름을 알고 있을떄) IP주소를 직접 알려줌.
  ->(모를 때) 알것 같은 DNS 서버에 문의
  - 이 문의를 처리하는 프로그램을 **리졸버**라고 한다.
    - 리졸버는 DNS서버에 포함될 수도 있다.
    - 디바이스 쪽에서 문의만 처리하는 스텁 리졸버도 있다.

<hr/>

## 8. ICMP - 통신 상태를 확인하는 프로토콜

    IMCP: 목적지와 연결을 설정하기 전 정보 교환아나 패킷이 잘 도착했는지 확인하는 기능 등을 규정한 프로토콜
        - Internet Control Message Protocol

### 경로상 장애 등을 통지하는 ICMP

- 주요 기능: 처리 실패나 장애가 발생했을 때 오류 메시지를 통지하는 것
  - 데이터를 주고받을 때 필요한 전처리, 후처리, 관리정보 교환
  - 구체적으로 라우터나 스위치에 문의하여 라우터 간 제어 정보 교환이나 목적지가 있는지 호스트가 작동하는지 등을 확인하는 다양한 목적으로 사용됨.
  - IMCP 패킷은 LAN뿐만 아니라 라우터를 넘어서 인터넷으로도 전송됨.

### ICMP 패킷의 구조

- ICMP 패킷의 구성: 헤더와 페이로드가 IP 패킷의 페어로드에 들어가는 형태
  - 헤더: 타입, 코드, 체크섬을 지정하는 필드가 있음
  - 페이로드: (유형과 코드에 따라 다양) 오류메시지와 전송데이터 등이 저장
    - 헤더의 필드와 페이로드의 크기도 타입과 코드에 따라 가변 길이(고정x)가 됩니다.
  - 타입: 패킷의 종류(ICMP, TCP, UDP 등)
  - 코드 내용: (타입에 따라 다름) 주로 타입3(목적지 도달 불가)의 원인을 나타내는 코드

### ICMP의 주요타입

| 타입 | 의미                    | 설명                                                                      |
| ---- | ----------------------- | ------------------------------------------------------------------------- |
| 0    | echo reply              | 에코응답: ping 등 호스트의 생사 확인                                      |
| 3    | destination unreachable | 목적지 도달 불가: 어느 라우터까지 도달했는지, 포트가 열려있는지           |
| 5    | redirect                | 기본 게이트웨이 이외의 경로 지정                                          |
| 8    | echo request            | 에코요청: ping 등 호스트의 생사 확인                                      |
| 11   | time exceeded           | 지정한 개수 이상의 라우터를 경우한 패킷을 폐기(무한루프나 핑퐁 패킷 억제) |

### ICMP 타입3의 주요 코드

| 코드 | 의미                                      | 설명                                        |
| ---- | ----------------------------------------- | ------------------------------------------- |
| 0    | network unreachable                       | 목적지 라우터가 다운되었다                  |
| 1    | host unreachable                          | 목적지 서버가 다운되었다                    |
| 3    | port unreachable                          | 포트가 닫혀 있다                            |
| 4    | fragmentation needed and DF set           | 단편화가 허용되지 않는다                    |
| 6    | destination network unknown               | 목적지가 라우팅 테이블에 설정되어 있지 않다 |
| 13   | Communication Administratively Prohibited | 차단되어 있다                               |

<hr/>

## 9. 텔넷 - 서버에 원격 로그인하는 프로토콜

### 원격으로 서버를 관리하는 텔넷

- 텔넷: 클라이언트 -> 서버로 원격로그인할 때 사용하는 프로토콜
  - 단말기와 서버가 텍스트 데이터로 주고받는다.
  - 마우스x, OS관리나 네트워크 설정 등은 키보드와 디스플레이로 가능
  - 3계층 이상의 네트워크 장치 설정도 텔넷 사용 가능
  - 클라이언트-서버형 채용
  - 서버는 텔넷 서버 프로그램, 단말기는 텔넷 클라이언트 애플리케이션이 필요한데
    리눅스나 macOS 등에서는 텔넷 서버가 **백그라운드 프로세스**로 항상 실행되고 있다.
  - 클라이언트 애플리케이션은 터미널 소프트웨어 등으로 부르며 '텔넷'이라는 이름이 붙어있는것이 대표적이다.

### 텔넷 연결 문제점

- 텔넷 사용 방법: 연결할 서버 이름 또는 IP 주소를 지정 -> 포트가 열려 있으면 연결 수락 후 로그인 프롬프트 화면에 표시 -> 사용자는 ID와 암호를 입력 -> 로그인
  - 문제점: 패킷을 암호화하는 기능x(로그인 후 작업하는 명령정보가 평문으로 네트워크로 흘러간다.)
  - 그래서 현재는 사용x, 대신 암호화 통신이 가능한 SSH를 사용

#### 용어 노트

- 백그라운드 프로세스: 사용자에게는 보이지 않으면서 컴퓨터나 서버 내부에서 실행되는 프로그램
- 로그인 프롬프트: 로그인에 필요한 인증 정보를 입력받는 화면 표시를 의미한다.

<hr/>

## 10. SSH - 암호화해서 원격 접속하는 프로토콜

### 공개키 암호화 방식의 원리

- SSH
  - 공개키 암호화 방식: 공개키와 개인키 2개가 있음(일반적으론 양쪽이 같은 키 공유)
    - 공개키: 네트워크 상에 공개하는 키(공개키와 암호문이 있어도 쌍이 되는 개인키가 없으면 복호화x)
    - 전자 서명에서 응용

### SSH 암호화 원리

- SSH는 암호화 키를 생성하고 공유하는 방식에 따라 2가지 유형

  - SSH1

    1. 클라이언트 서버로 접속 시도 -> 서버는 공개키와 함께 자신의 호스트 키를 클라이언트에게 제공
    2. 클라이언트는 서버의 공개키를 사용하여 세션 키 생성 -> 세션 키를 서버의 공개키로 암호화하여 서버에게 전송
    3. 서버는 자신의 개인키를 사용하여 클라이언트가 보낸 암호화된 세션 키를 복호화.
    4. 이제 서버와 클라이언트는 서로 공유한 세션키를 사용하여 통신을 암호화

  - SSH2: 디피-헬만 키 교환 방식(HTTPS도 같은 방식)

    1. 양측이 개인키와 공개키를 생성 -> 공개키를 교환
    2. 자신의 개인키와 상대방의 공개키로 특수한 값 산출 -> 산출한 값 교환
    3. 교환한 값과 개인키로 계산 -> 같은 값이면 공동키로 그것을 암호화해서 통신.

    <hr/>

## 11. FTP - 파일을 송수신하는 프로토콜

FTP(File Transfer Protocol): 호스트, 클라이언트 <--> 서버(FTP 서버) 사이에서 파일을 주고받는 프로토콜

### 파일 전송 기능 및 보안 문제

- 클라이언트가 FTP서버에 로그인하면 서버에 있는 파일을 내려받거나 클라이언트의 파일을 업로드할 수 있다.
- FTP서버에 접속하는 방법:FTP 서버에 계정을 만들어 두고 그 계정으로 로그인

  - 로그인할 때 암호화되지 않는다. 따라서 SCP나 SFTP처럼 암호화 통신이 가능한 프로토콜과 이를 지원하는 서버 또는 클라이언트 프로그램이 대체되고 있다.

    - SCP(Secure Copy Protocol): FTP 보안문제를 개선하고 암호화 통신을 이용한 파일전송으로 처리와 통신 안전성을 높인 프로토콜이다
    - SFTP(SSH File Transfer Protocol): SCP와 마찬가지로 FTP의 안전성을 높이고자 SSH를 사용한 암호화 통신으로 파일을 전송하는 프로토콜이다.

### 액티브와 패시브 두 가지 전송 모드

- FTP 포트

  - 컨트롤 포트(TCP21): 세션을 관리
  - 데이터 포트(TCP20): 파일을 전송(서버끼리 파일을 전송하는 포트)
    - 클라이언트의 파일 전송은 임의의 포트를 사용
  - 포트를 나눈 이유: 파일 전송 중에도 중단 등 관리할 수 있도록 하기 위해서.

  - 액티브 모드: TCP20을 데이터 포트로 사용하는 모드
  - 패시브 모드: 임의의 포트를 네고시에이션하는 모드

cf. 네고시에이션: 서버와 통신할 때 적절히 통신할 수 있도록 접속하는 포토번호 등 조건이나 절차를 결정하는 일을 의미한다.

<hr/>

## 12. NTP - 시간을 동기화하는 프로토콜

NTP(Network Time Protocol): 호스트 간에 시간을 동기화 하는 프로토콜

### 컴퓨터 내 시간을 동기화하는 NTP

컴퓨터나 서버는 내부에 시계를 가지고 있어 그 시간으로 파일의 타임스탬프를 기록하거나 로그파일의 시간 정보로 사용합니다.
그러나 모든 컴퓨터의 시계엔 올바르개 설정돼있지 않다. --> NTP

- 클라이언트가 문의 -> NTP 서버가 응답 -> 클라이언트가 해당 시간 데이터로 내부 시계를 설정
- NTP가 응답하는 시간
  - GPS의 시간정보
  - 각 국가에서 관리하는 표준 시계 정보를 이용

### 계층 구조로 배치되는 NTP

NTP서버는 표준시간에 가까운 서버 아래 계층적으로 배치됩니다.
계층 구조 상위에 있는 서버를 Stratum1이라고한다.
Stratum1 > Stratum2 > Stratum3으로 NTP서버가 분기되어 연결 되어 있는데 계층이 깊어지면 시간 오차가 누적되어가지만, Stratum2이 오차를 예층해서 보정합니다.

<hr/>

## 13. Ajax, REST API - 그 밖의 웹 기술과 프로토콜

### 통신 대기 시간에 다른 처리를 하는 Ajax

- 동기 통신: 요청에 대한 응답을 반환하고 데이터가 준비될 때까지 다음 처리를 하지 않는다.
- 비동기 통신: 모든 응답이 완료되기 전에 다른 처리, 요청을 해서 가능한 일을 동시에 처리.
  - 실현하려면 응답으로 주고받는 데이터양을 줄여야함
    > XML 형식으로 필요한 데이터만 주고받으며 비동기 통신을 가능케함 - Ajax(Asynchronous Javascript + XML)
    - ex) 웹에서 지도를 스크롤, SNS에서 타임라인 표시, 게임처럼 반응하는 웹 페이지

### 기능 호출에 사용되는 REST API

- REST-API: 애플리케이션 간 처리나 호출 방법 등을 정한 규약
  - HTTP(S)를 사용하며 HTML, JSON,PHP 등으로 처리 내용 or 처리 데이터를 주고 받습니다.
  - 웹 브라우저가 연결된 DB나 백엔드 시스템 등 기능을 호출할 때 사용됨.
  - 웹 브라우저 이외에 애플리케이션이 직접 업무 시스템에 요청하거나 문의할 수도 있습니다.
  - 클라우드 서비스는 대부분 REST-API를 이용하여 서로 연계하면서 하나의 서비스를 구축.

#### 용어 노트

- XML(eXtensivble Markup Language): 범용적인 마크업 언어로, XML에서는 정보의미나 구조 등을 포함하는 태그를 독자적으로 지정할 수 있다.
