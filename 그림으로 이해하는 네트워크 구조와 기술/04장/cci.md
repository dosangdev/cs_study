# 인터넷 구조

인터넷은 ISP, IX등 수 많은 네트워크들이 연결된 광범위한 네트워크이다.

인터넷의 기원은 1967년 ARPANET 프로젝트에서 패킷통신망 연구로 거슬러 올라간다.

1980년 후반부터 네트워크간 연결은 해준다는 의미의 인터넷(Internet)으로 불리게 된다.

인터넷에서 중요한 역할을 하는 장치로는 라우터가 있다.

패킷의 IP주소로 내 외부 LAN의 교통정리를 한다. 

## WHAT IS ARPANET?

미국 국방부 산하 고등 연구 계획국(ARPA)가 제작한 패킷교환 방식을 이용한 네트워크로, 이름의 뜻은 ARPA + net 이다.

이 프로젝트는 대형 중앙 서버 하나에 만약 핵폭탄이 떨어진다면 어떻게 될까라는 생각에서 출발했다고 한다.

그래서 서버를 분산시켜 관리하는 아이디어가 채택되었고

1969년 미국 국방부는 4개의 대학(UCLA, UCSB, 스탠퍼드 연구소, 유타 대학교)에 서버를 설치하고 이를 연결하는 프로젝트를 시작했다. 그리고 2년 뒤인 1971년 이메일이 탄생하였다.

네트워크가 이렇게 연결되고 각 대학교가 학문 연구를 이유로 다양한 시도를 하면서, 다른 대학교도 나도 참여하자며 계속 아파넷은 확장하게 되고 결국 1983년 TCP/IP로 전환이 완료되자 국방부는 아파넷을 민간에 풀어버린다. 그리고 아파넷은 전세계로 연결되어 인터넷이 되었다.

# 인터넷에서 사용하는 프로토콜

인터넷에서 사용하는 기본 프로토콜은 TCP/IP이다. 그러나 다양하고 복잡한 기능(동영상 전송, 이메일 송수신 등)은 이 프로토콜만으로는 구현이 불가능하다.

이 기능들을 구현하기 위해서는 TCP/IP의 상위 프로토콜이나 서비스 프로토콜이 필요하다.

서비스 프로토콜은 다양한 웹 앱 서비스, 클라우드 서비스 등 이런 서비스를 제공하는데 필수적이다. 잘 알려진 포트번호들은 대부분 이런 서비스 프로토콜에 할당되어 있고, IANA에서 할당을 관리한다.

# 이메일을 주고 받는 구조

### SMTP로 이메일 보내기

1. 받는 사람의 이메일 주소를 지정하여 메일 서버로 전송한다.
2. 송신 메일 서버는 이메일 주소의 도메인 이름(@오른쪽)을 확인 후 받는 사람의 수신 메일 서버로 전송한다.
- 송신 메일 서버를 SMTP 서버라고도 한다. SMTP 서버는 DNS구조를 이용하여 도메인 이름에 대한 IP 주소 정보를 얻는다.

### POP으로 이메일 받기

1. POP 서버는 자신의 도메인으로 온 이메일을 받으면 사용자ID를 확인후 스풀 파일에 이메일을 저장한다.
2. 사용자는 로그인 인증을 거쳐야 한다.
3. 메일 클라이언트가 POP 서버에 접속해서 정상 사용자로 인정받으면 사용자는 스풀 파일에 있던 이메일을 내려받는다.
4. 내려받은 후 스풀 파일에 저장됐던 이메일은 삭제된다. (그래서같은 계정이여도 다른 컴퓨터면 볼 수가 없다.)
- POP 프로토콜을 사용하므로 POP 서버라고 불린다. 올바른 사용자에게 이메일을 전달하기 위하여 등록 사용자 데이터베이스를 가지고 있다. 기본적으로 @왼쪽의 ID를 사용자 ID로 사용한다.

### IMAP(Internet Message Access Protocol)

스풀 파일에서 이메일을 지우지 않아 다른 기기에서도 같은 계정이라면 이메일을 볼 수 있다.

보통 우리가 쓰는 이메일 프로토콜이 이것이다.

POP3를 사용하게 되면 네이버에서 보낸메일함, 스팸메일함, 휴지통의 메일을 볼 수가 없다고 한다.

# 웹 페이지를 열람할 수 있는 구조

웹이라는 도구를 통해 우리는 거대한 인터넷을 이용할 수 있다.

웹은 서버-클라이언트형의 구조로 이루어져 있으며, HTTPS, REST API, HTML등 프로그래밍 언어, 데이터베이스, XML 등의 인프라 기술들로 이용할 수 있다.

# URL / URI (Uniform Resource Location)

URL은 어느 웹 서버의 특정 파일인가를 식별할 수 있게 해 주는 정보이다.

<aside>
💡 https://user1:pass1@aaa.bbb.kr:8080/abc/def.html?z=p1#p2

</aside>

URL 기본 구조 : 스키마//(사용자정보)호스트 정보(포트 정보)/경로/쿼리/프래그먼트

URI나 URN (Uniform Resource Identifier or Name)은 특정 파일(데이터)의 위치를 기술하는 방법을 알려주는 정보이다.

# HTTP / HTTPS

HTTP는 웹에서 패킷을 교환하는 방식을 규정한 프로토콜이다.

HTTP는 불특정 다수의 웹브라우저에서 서버에 요청을 할 때, 그 때마다 HTML 문서를 보내는 것은 비효율적이고 그 상태를 계속 유지하는 것도 어렵기 때문에 웹 브라우저의 캐시(임시 저장) 기술을 사용하여 스테이트리스 방식으로 통신한다.

# DNS (Domain Name System)

DNS는 도메인 이름과 iIP 주소의 대응표를 관리하는 체계이다.

### IP 주소를 쉽게 다룰 수 있도록 한 도메인 이름

숫자로만 보이는 IP 주소를 사람이 다룰 기 쉬운 이름으로 고안 된 것이 도메인 이름이다.

그리고 DNS 이 IP 주소와 도메인 이름을 대응시켜 관리한다.

### DNS의 관리 방법

- 여러 DNS 서버에 분산한다.
- 도메인 이름과 IP 주소가 영역이라는 단위로 관리된다.
- 영역 정보를 유지하는 서버를 권한 DNS 서버 또는 네임 서버라고 한다.
- DNS에서 클라이언트에서 IP 주소 문의가 있을 때 LAN 내 DNS 서버가 도메인 이름을 알고 있다면 IP 주소를 직접 알려주고 모른다면 알고 있을 것으로 예상되는 DNS 서버에 문의한다.

# ICMP

정보 교환이나 패킷이 잘 도착했는지 확인하는 기능 등을 규정한 프로토콜이다.

### ICMP 역할

- 처리 실패나 장애가 발생했을 때 오류 메시지를 통지한다.
- 목적지에서 적절히 응답하는지 파악한다.
- 데이터를 주고받을 때 필요한 전처리, 후처리, 관리 정보도 교환한다.

### ICMP 사용

- ICMP는 구체적으로 라우터나 스위치에 문의하여 라우터 간 제어 정보 교환이나 목적지가 있는지, 호스트가 작동하는지 등을 확인하는 다양한 목적으로 사용된다.

### ICMP 패킷구조

- 헤더 + 페이로드
- 헤더 : 타입, 코드, 체크섬
- 페이로드 : 유형과 코드에 따라 다양, 오류 메시지와 전송데이터 등이 저장된다.
- 헤더와 페이로드 둘다 타입과 코드에 따라 가변이 되는 길이다.
- IP 패킷의 페이로드에 포함되어 있다.

### 자주 사용되는 ICMP 타입 3의 코드 (오류 메시지)

| 코드 | 의미 | 설명 |
| --- | --- | --- |
| 0 | network unreachable | 목적지 라우터가 다운되었다. |
| 1 | host unreachable | 목적지 서버가 다운되었다. |
| 3 | port unreachable | 포트가 닫혀 있다. |
| 4 | fragmentation needed and DF set | 단편화가 허용되지 않는다. |
| 6 | destination network unknown | 목적지가 라우팅 테이블에 설정되어 있지 않다. |
| 13 | communication administaratively prohibited by filtering | 차단되어 있다. |

# 텔넷

단말기에서 서버에 원격으로 로그인하는 프로토콜이다.

### 텔넷 특징

- 단말기와 서버가 텍스트 데이터를 주고 받는다.
- 마우스를 사용할 수 없지만 키보드와 디스플레이로 OS관리, 네트워크 설정은 할 수 있다.
- 3계층 이상의 네트워크 장치(라우터, L3 스위치, 방화벽 등)를 설정할 때도 사용 가능하다.
- 클라이언트-서버 방식이다.
- 리눅스와 macOS에서는 텔넷이 백그라운드 프로세스로 항상 실행되고 있다.

### 텔넷 연결 과정

1. 연결할 서버 이름 or IP 주소를 지정한다.
2. 포트(TCP23)이 열려 있으면 연결을 수락한다.
3. 로그인 프롬프트를 화면에 표시한다.
4. 사용자 ID와 암호를 입력하여 서버에 로그인한다.

### 텔넷 문제점

- 패킷을 암호화하는 기능이 없기 때문에 로그인을 한 후 작업은 **평문**으로 네트워크로 흘러들어간다. 그래서 요즘은 텔넷은 사용하지 않고 암호화 통신이 가능한 SSH를 사용한다.

# SSH

텔넷 대신 서버에 원격 로그인 할 때 쓰는 프로토콜이다.

### 공개키 암호화 방식

- 일반적인 암호화 방식(공통키 방식)은 양 쪽이 같은 키를 공유. 공개키 암호화는 공개키와 개인키 2가지를 사용한다.
- 공개키는 네트워크 상에 공개된 키이지만, 공개키로 암호화 된 데이터는 개인키가 없으면 복호화 하지 못한다.
- 개인키를 가진 목적지에서만 복호화 할 수 있다.
- 사례로는 전자 서명이 있다.

### SSH2 (디피-헬만 방식)

1. 각각 개인키와 공개키를 생성한다.
2. 공개키를 서로 교환한다.
3. 자신의 개인키와 상대의 공개키로 특수한 값을 산출한다.
4. 산출한 값을 교환한다.
5. 교환한 값과 개인키로 또 계산을 한다.
6. 계산 결과가 같아지면 그것을 공통키를 사용한다.
7. 공통키로 암호화해서 통신한다.

# FTP

호스트 사이 혹은 클라이언트와 서버 사이에서 파일을 송수신 할 때 쓰는 프로토콜이다.

### 특징

- 웹, 파일 서버 보다 오래됐다.
- FTP 서버에 클라이언트가 로그인 하면 서버의 파일을 다운받거나, 클라이언트의 파일을 업로드 할 수 있다.
- 계정을 만들어 두고 로그인해야 하며, 계정이 필요없는 anonymousFTP도 있다.
- 텔넷과 마찬가지로 암호화가 되지 않는다. 그래서 SCP나 SFTP 혹은 이를 지원하는 서버 또는 클라이언트 프로그램으로 대체되고 있다.

### FTP 포트와 전송 모드

- FTP는 세션을 관리하는 컨트롤 포트(TCP21)와 파일을 전송하는 데이터 포트(TCP20) 2개의 포트를 사용한다. (임의의 포트는 뭐임?)
- 데이터 포트는 서버간 파일을 전송할 때 쓰는 포트이다.
- 임의의 포트는 클라이언트 서버끼리 파일 전송할 떄 쓰는 포트이다.
- TCP20을 데이터 포트로 사용하는 모드를 액티브 모드라고 한다.
- 임의의 포트로 네고시에이션 하는 모드를 패시브 모드라고 한다.
- 컨트롤 포트와 데이터 포트로 나눈 것은 파일의 전송 중에도 중단 등 관리할 수 있도록 하기 위함이다.

# NTP

전 세계 컴퓨터나 서버 등의 내부 시각을 정기적으로 동기화하는 프로토콜이다.

### NTP의 존재 의의

- 컴퓨터나 서버는 내부에 시계를 가지고 있어 그 시간을 기준으로 파일의 타임스태프를 기록하거나 로그 파일의 시간 정보로 사용한다.
- 은행 거래, 증권 거래 등 인터넷에서 하는 모든 서비스의 시간을 동기화 해서 같은 시간에 통신하게 해주기 때문에 매우 중요하다.

### NTP 서버

- 클라이언트가 NTP 서버에 문의하면 시간을 알려주고 클라이언트는 그것을 내부 시간으로 설정한다.
- NTP 서버가 응답하는 시간은 GPS의 시간 정보나 각 국가에서 관리하는 표준시계(원자 시계, 분자시계 등)의 정보를 이용한다.

### NTP의 계층구조

- 계층 구조 최상위에 있는 서버는 Stratum 1이다.
- 차례로 Stratum2 Stratum3 서버가 분기되어 연결되어 있다.
- 계층이 깊어지면 오차가 누적되지만, Stratum2 이하는 오차를 예측해서 보정한다.
- 한국은 한국표준과학연구원의 세슘원자시계가 있다.

# Ajax / REST API

비동기 처리를 하는 Ajax (Asynchronous Javascript + XML) 

애플리케이션 사이에서 기능을 호출하는 REST API (REpresentational Application Programming Interface)

### Ajax

- XML 형식으로 필요한 데이터만 주고받으며 비동기 통신을 한다.
- 웹에서 지도를 스크롤하거나, SNS에서 타임라인을 표시, 게임처럼 반응하는 웹 페이지는 모두 Ajax로 구현된 것이다.

### REST API

- 애플리케이션 간 처리나 호출 방법을 정한 규약이다.
- 보통 HTTP(S)를 사용하며 HTML, PHP, JSON 등의 형식으로 통신한다.
- 웹 브라우저가 웹 서버의 백엔드 시스템의 기능을 호출할 때 사용된다. 웹 서버는 가운데서 전달해주는 역할을 한다.
- 애플리케이션 간 연계 서비스 (지도 서비스에서 식당 예약하기 등)이 REST API로 구현되는 서비스이다.