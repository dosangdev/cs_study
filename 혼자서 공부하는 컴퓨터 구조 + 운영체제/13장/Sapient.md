# 13. 교착 상태


## 13-1. 교착 상태란
### 일어나지 않을 사건을 기다리며 진행이 멈춰 버리는 현상을 교착 상태라고 한다. 즉, 상대방이 가진 자원을 기다리기만 하다가 결국 실핸 한 번 못하는 상황이다.
#### 교착 상태를 해결하기 위해서는
> 1. 교착 상태가 발행했을 때의 상황을 정확히 표현해 보기
> 2. 교착 상태가 일어나는 근본적인 이유에 대해 알기


### 자원 할당 그래프
#### 프로세스가 어떤 자원을 사용하고 있고, 또 어떤 프로세스가 어떤 자원을 기다리고 있는지를 표현하는 간단한 그래프이다.
#### 자원 할당 그래프 그리는 규칙
> 1. 프로세스는 원으로, 자원의 종류는 사각형으로 표현한다.
> 2. 사용할 수 있는 자원의 개수는 자원 사각형 내에 점으로 표현한다.(같은 자원이라도 사용 가능한 자원의 개수는 여러 개 있을 수 있다.)
> 3. 프로세스가 어떤 자원을 할당받아 사용 중이라면 자원에서 프로세스를 향해 화살표를 표시한다.
> 4. 프로세스가 어떤 자원을 기다리고 잇다면 프로세스에서 자원으로 화살표를 표시한다.
#### 교착 상태가 발생한 상황은 자원 할당 그래프가 원의 형태를 띄고 있다.



### 교착 상태 발생 조건
#### 교착 상태가 발생하려면 상호 배제, 점유와 대기, 비선점, 원형 대기 네 가지 조건이 모두 만족 되어야 한다.
> - 상호 배제: 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때, 즉 상호 배제 상황에서 교착 상태가 발생할 수 있다.
> - 점유와 대기: '자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태'. 즉, 자원을 보유한 채 다른 자원을 기다리기 때문에 문제가 발생한다.
> - 비선점: 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못하기 때문에 교착 상태가 발생한다.
> - 원형 대기: 프로세스들과 프로세스가 요청 및 할당받은 자원이 원의 형태를 이룬다. 하지만 원의 형태를 띈다고 해서 반드시 교착 상태가 발생하는 것은 아니다.




## 13-2. 교착 상태 해결 방법
#### 교착 상태는 예방, 회피, 검출 후 회복으로 해결할 수 있다.


### 교착 상태 예방
#### 교착 상태 예방은 교착 상태 발생 필요 조건 네 가지 중 하나를 충족하지 못하게 하는 것이다.
> - 상호 배제 제거: 상호 배제를 없애는 것은 모든 자원을 공유 가능하게 만든다는 말이므로 현실에서는 다소 무리가 있다.
> - 점유와 대기 제거: 운영체제가 특정 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는 방식으로 배분한다.
                  자원의 활용률이 낮아진다는 점과, 많은 자원을 필요로하는 프로세스가 무한정 기다리게되는 기아 현상이 발생할 수 있다는 단점이 있다.
> - 비선점 조건 제거: 자원을 이용 중인 프로세스로부터 해당 자원을 빼앗는다. 하지만 프린터 자원과 같이 모든 자원을 선점 불가능한 자원도 있기 때문에 자원을 빼앗아 교착 상태를 예방하는 방법은 범용성이 떨어진다.
> - 원형 대기 제거: 모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당하는 방법. 수많은 자원에 번호를 붙이는 일이 간단하지 않고,각 자원에 어떤 번호를 붙이는지에 따라 특정 자원의 활용률이 떨어질 수 있다는 단점이 있다.
#### 예방 방식은 교착 상태가 발생하지 않음을 보장할 수는 있지만 여러 부작용이 따른다.


### 교착 상태 회피
#### 교착 상태가 발생하지 않을 정도로만 자원을 할당하는 방식
#### 교착 상태 회피 방식에서 쓰이는 용어
> 안전 상태: 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태
> 불안전 상태: 교착 상태가 발생할 수도 있는 상황
> 안전 순서열: 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서
#### 안전 순서열대로 프로세스들에 자원을 배분하여 교착 상태가 발생하지 않는 상태를 안전상태라고 하고 순서열이 없는 상태를 불안전 상태라고 한다.
#### 운영체제가 교착 상태를 회피하기 위해서는 시스템 상태가 안전 상태에서 안전 상태로 움직이는 경우에만 자원을 할당하면 된다.



### 교착 상태 검출 후 회복
#### 교착 상태 발생 이후 사후 조치하는 방식
#### 프로세스들이 자원을 요구할 때마다 할당하며, 교착 상태 발생 여부를 주기적으로 검사하고 교착 상태가 발생하면 그때 회복한다
#### 교착 상태 회복 방식
> 선점을 통한 회복: 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식
> 프로세스 강제 종료를 통한 회복: 프로세스를 모두 강제 종료하거나, 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료한다. 전자는 확실하게 교착상태를 해결하지만 많은 프로세스들이 작업 내역을 잃을 수 있고, 후자는 작업 내역 손실을 줄이는 대신 교착 상태 여부를 확인하는 과정에서 오버헤드가 발생할 수 있다.
#### 교착 상태를 드물게 발생하는 잠재적 문제로서 무시로 대처하는 방식인 타조 알고리즘도 있다.
