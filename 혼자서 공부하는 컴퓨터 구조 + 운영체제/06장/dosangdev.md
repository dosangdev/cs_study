# 메모리와 캐시 메모리

## RAM의 특징과 종류

### RAM의 특징

- RAM은 휘발성 저장 장치이다,

  - 전원을 끄면 저장된 명령어와 데이터가 모두 날아간다.

- 보조기억장치는 비휘발성 저장 장치이다.

  - ex) 하드디스크, SSD, CD-ROM, USB메모리

- 이러한 특징들 때문에 일반적으로 보조기억장치엔 '보관할 대상'을 저장하고, RAM엔 '실행할 대상'을 저장한다.
  - CPU가 실행하고 싶은 프로그램이 보조기억장치에 있다면 이를 RAM으로 복사하여 저장한 뒤 실행한다.

### RAM의 용량과 성능

- CPU가 실행하려는 프로그램이 보조기억장치에 있다면 이를 RAM으로 가져와야할 때 RAM의 용량이 크면 많은 데이터를 미리 가져와 실행할 때 여러번 가져오는 수고를 덜 수있어서 더 빠르게 실행시킬 수 있다.

### RAM의 종류

- DRAM(Dynamic RAM): 저장된 데이터가 동적으로 변하는(사라지는) RAM. 시간이 지나면 저장된 데이터가 점차 사라지기 떄문에 일정 주기로 데이터를 재활성화(다시 저장)해야 한다.
  - 일반적으로 사용되는 메모리
    - 소비 전력이 비교적 낮고, 저렴하고, 집적도가 높기 떄문에 대용량으로 설계하기가 용이하다.
- SRAM(Static RAM):시간이 지나도 저장된 데이터가 사라지지 않는 RAM 일반적으로 DRAM보다 속도가 빠르다.
  - 소비 전력이 높고, 비싸고, 집적도가 낮다.
- SDRAM(Synchronous Dynamic RAM): 클럭과 동기화된 DRAM이다(클럭 타이밍에 맞춰 CPU와 정보를 주고받을 수 있음).
- DDRSDRAM(Double Data Rate SDRAM): 대역폭을 넓혀 속도를 빠르게 만든 SDRAM
  - 최근 가장 흔히 사용되는 RAM
  - 전송 속도가 빠르다
  - 대역폭: 데이터를 주고받는 길의 너비

## 메모리의 주소 공간

    메모리에 저장된 정보의 위치는 주소로 나태낼 수 있고, 이 주소는 두 종류가 있다.

### 물리 주소와 논리 주소

- 물리 주소: 정보가 실제로 저장된 하드웨어상의 주소
- 논리 주소: 실행중인 프로그램 각각에게 부여된 0번지부터 시작되는 주소
- CPU가 이해하는 주소가 논리주소이지만 메모리와 상호작용하려면 논리주소와 물리주소간의 변환이 이루어져야 된다.
  - 논리 -> 물리: CPU와 주소 버스 사이에 위치한 메모리 관리 장치(MMU)라는 하드웨어에 의해 수행된다.
    - CPU가 발생시킨 논리주소에 베이스 레지스터 값을 더하여 논리주소를 물리주소로 변환 시킨다
    - 예) 베이스 레지스터는 15000, 논리주소는 100번지라면 물리주소 15100번지로 변환됨.
    - 베이스 레지스터: 프로그램의 가장 작은 물리주소

### 메모리 보호 기법

    다른 프로그램의 영역을 침범할 수 있는 명령어는 위험하기 떄문에 논리 주소 범위를 벗어나는 명령어 실행을 방지하고,
    실행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록 보호할 방법이 필요하다
    이는 한계 레지스터가 담당한다

- 한계 레지스터: 논리 주소의 최대 크기를 저장한다. 즉 프로그램의 물리 주소범위는 베이스 레지스터 값 이상, 베이스 레지스터값 + 한계 레지스터 값 미만이다.
- CPU는 메모리에 접근하기 전에 접근하고자 하는 논리 주소가 한계 레지스터보다 작은지 항상 검사한다. 만양 CPU가 한계 레지스터보다 높은 논리 주소에 접근하려 하면 인터럽트를 발생시켜 실행을 중단한다.

## 캐시 메모리

    CPU가 메모리에 접근하는 시간은 CPU의 연산속도보다 드리다.
    CPU가 연산을 빨리해도 메모리 접근시간이 느리면 CPU의 연산속도가 쓸모가 없기 때문에 이를 극복하기 위해
    나온 것이 캐시메모리이다.
    캐시 메모리의 탄생 배경과 특징을 이해하려면 저장 장치 계층 구조라는 개념을 이해해야한다.

### 저장 장치 계층 구조

- 각기 다른 용량과 성능의 저장 장치들을 계층화하여 표현한 구조이다.
  ![저장장치계층구조] (https://velog.velcdn.com/images%2Fyu-jin-song%2Fpost%2Ff9c8088c-0fec-4dad-ac95-ddf3601aa1d4%2F%EB%A9%94%EB%AA%A8%EB%A6%AC_%EA%B3%84%EC%B8%B5_%EA%B5%AC%EC%A1%B0.png)

  - 위 계층으로 올라갈수록 CPU와 가깝고 용량은 작지만 빠른 저장 장치이다(비싸다).
  - 아래 계층으로 내려갈수록 CPU와 멀고 용량은 크지만 느린 저장 장치이다(싸다).

### 캐시 메모리

- CPU와 메모리 사이에 위치하고, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM기반의 저장 장치이다.
- 메모리에서 CPU가 사용할 일부 데이터를 미리 캐시 메모리로 가지고와서 활용.
- 캐시메모리는 여러 개가 있다. 이 캐시 메모리들은 CPU와 가까운 순서대로 계층을 구성한다.
  - 코어와 가장 가까운 캐시메모리를 **L1캐시**부터 L2캐시, L3캐시 까지 있다.
  - 캐시메모리의 용량은 L1,L2,L3순으로 커지고 속도는 L3,L2,L1 순으로 빨리진다.가격은 L3,L2,L1순을로 비싸진다.
  - CPU가 메모리 내에 데이터가 필요하다고 판단하면 L1을 보고 없다면 L2,L3순으로 데이터를 검색한다.
  - 멀티 코어 프로세스에서는 일반적으로 L1캐시와 L2캐시는 코어마다 코유한 캐시메모리로 할당되고, L3캐시는 여러 코어가 공유하는 형태로 사용된다.
  - 코어와 가장 가까운 L1캐시는 조금이라도 접근 속도를 빠르게 만들기 위해 명령어만 저장하는 L1I캐시와 데이터만을 저장하는 L1D캐시로 분리하는 경우도 있는데 이걸 분리형 캐시라고 한다.

### 참조 지역성 원리

- 캐시메모리는 CPU가 사용할 법한 대상을 예측하여 저장한다. 이때 예측한 데이터가 실제로 맞아 캐시메모리 내 데이터가 CPU에서 활용될 경우를 캐시 히트(cache hit)라고 한다. 반대로 예측이 틀려 메모리에서 필요한 데이터를 직접 가져와야하는 경우를 캐시 미스(cache miss)라고 한다.
- 캐시가 히트되는 비율을 캐시 적중률이라 하고 다음과 같이 계산한다.
  - 캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수)
  - 우리가 사용하는 컴퓨터의 캐시 적중률은 대략 85%~95% 이상이다.
- 캐시 메모리는 참조 지역성의 원리를 가지고 메모리부터 가져올 데이터를 결정한다.
  - 참조 지역성의 원리: CPU가 메모리에 접근할 때의 주된 경향을 바탕으로 만들어진 원리
    - 1.최근에 접근했던 메모리 공간에 다시 접근하려는 경향(=시간 지역성)
      - 변수같은 일반적으로 한 번만 사용되지 않고 프로그램이 실행되는 동안 여러번 사용되는 것들
    - 2.접근한 메모리 공간 근처를 접근하려는 경향(=공간 지역성)
      - 하나의 프로그램 내에서 관련있는 데이터들을 저장하는 경향.
