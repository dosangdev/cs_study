# 메모리와 캐시 메모리

## 06-1. RAM의 특징과 종류

### RAM의 특징

- RAM은 전원을 끄면 저장된 내용이 사라지는 휘발성 저장 장치 이다.
- 반면 전원이 꺼져도 저장된 내용이 유지되는 저장 장치를 비휘발성 저장 장치 라고 하는데 보조기억장치가 대표적인 비휘발성 저장 장치 이다.
- 비휘발성 저장 장치에는 보관될 대상을 저장하고 휘발성 저장 장치에는 실행할 대상을 저장한다.

### RAM의 용량과 성능

- RAM의 용량이 적다면 CPU가 실행할 프로그램을 보조기억장치에서 RAM으로 가져오는 작업을 자주 해야 하기 때문에 실행 시간이 길어진다.
- 반면에 RAM 용량이 크다면 여러 프로그램들을 RAM으로 미리 가져와 저장해 둘 수 있기 때문에 많은 프로그램들을 동시에 빠르게 실행하는데 유리하다.
- 그렇지만, RAM 용량이 엄청나게 커진다고 해서 그에 비례하게 실행 속도가 빨라지는 것은 아니다.

### RAM의 종류

- DRAM
    - 저장된 데이터가 동적으로 변하는(사라지는) RAM을 의미한다.
    - 시간이 지나면 저장된 데이터가 점차 사라지기 때문에 데이터의 소멸을 막기 위해 일정 주기로 데이터를 재활성화(다시 저장) 해야한다.
    - 소비 전력이 낮고, 싸고, 집적도가 높아 대용량으로 설계하기가 용이하기 때문에 일반적으로 메모리로써 DRAM을 사용한다.
- SRAM
    - 저장된 데이터가 변하지 않는 RAM을 의미한다.
    - 즉 시간이 지나도 데이터가 사라지지 않으며 일반적으로 DRAM 보다 빠르다.
    - 소비전력이 높고, 비싸고, 집적도가 낮아 메모리로 사용하기 적절하진 않다.
    - 대신 대용량으로 만들어질 필요는 없지만 속도가 빨라야하는 저장 장치(캐시 메모리)에서 사용된다.
- SDRAM
    - 클럭 신호와 동기화된, 발전된 형태의 DRAM이다.
    - 클럭에 맞춰 동작하며 클럭마다 CPU와 정보를 주고 받을 수 있는 DRAM이다.
- DDR SDRAM
    - 최근 가장 흔히 사용되는 RAM으로 대역폭(데이터를 주고받는 길의 너비)을 넓혀 속도를 빠르게 만든 SDRAM이다.
    - DDR SDRAM은 SDRAM보다 대역폭이 2배 넓다. 즉 한 클럭당 두 번씩 CPU와 데이터를 주고 받을 수 있다.
    - SDRAM을 SDR SDRAM이라 부르기도 한다.
    - DDR2 SDRAM, DDR3 SDRAM, … 은 각각 DDR SDRAM의 2배, 4배의 대역폭을 가지고 있다. 즉, DDR(N) SDRAM은 DDR SDRAM의 2의 N제곱 만큼의 대역폭을 가지고 있다.

## 06-2. 메모리의 주소 공간

### 물리 주소와 논리 주소

- 물리 주소
    - 메모리가 사용하는 주소로, 말 그대로 정보가 실제로 저장된 하드웨어상의 주소이다.
- 논리 주소
    - CPU와 실행 중인 프로그램이 사용하는 주소로, 실행 중인 프로그램 각각에게 부여된 0번지부터 시작되는 주소를 의미한다.
    - 프로그램마다 같은 논리 주소를 가질 수 있다.
- MMU(메모리 관리 장치)
    - CPU가 메모리와 상호작용 하기 위해 필요한 논리 주소와 물리 주소간의 변환을 수행하는 하드웨어
    - CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더하여 논리 주소를 물리 주소로 변환한다.
    - 베이스 레지스터는 프로그램의 가장 작의 물리 주소, 즉 프로그램의 첫 물리주소를 저장하고 논리 주소는 프로그램의 시작점으로부터 떨어진 거리이다.

### 메모리 보호 기법

- CPU가 발생 시킨 논리 주소가 해당 프로그램의 물리 주소의 범위를 벗어나게 된다면 해당 명령어는 다른 프로그램의 영역을 침범할 수 있기 때문에 해당 명령어는 실행 되어서는 안된다.
- 한계 레지스터
    - 논리 주소의 최대 크기를 저장하는 레지스터
    - CPU가 접근하려는 논리 주소는 한계 레지스터가 저장한 값보다 커서는 안된다. 한계 레지스터가 저장한 값보다 논리 주소가 크다는 것은 프로그램의 범위에 벗어난 메모리 공간에 접근하는 것과 같다.
    - CPU는 메모리에 접근하기 전에 접근하고자 하는 논리 주소가 한계 레지스터보다 작은지를 항상 검사하고 접근하려는 논리 주소가 한계 레지스터보다 높다면 인터럽트를 발생시켜 실행을 중단한다.
    - 참고로 프로그램의 물리 주소 범위는 베이스 레지스터 값 이상 ~ 베이스 레지스터 값 + 한계 레지스터 값 미만이다.

## 06-3. 캐시 메모리

### 저장 장치 계층 구조

- 저장 장치는 일반적으로 다음과 같은 명제를 따른다.
    - CPU와 가까운 저장장치 일수록 빠르다.
    - 빠르면 용량이 작고, 비싸다.
- 저장 장치들의 장단점이 명확하기 때문에 컴퓨터는 다양한 저장 장치를 모두 사용한다.
- 저장 장치들을 ‘CPU에 얼마나 가까운가’를 기준으로 계층적으로 나타낸 것을 **저장 장치 계층 구조**라고 한다.

### 캐시 메모리

- CPU와 메모리 사이에 위치하고, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치이다.
- CPU가 프로그램을 실행할 때 메모리에 빈번하게 접근해야 하는데 CPU의 연산 속도가 CPU가 메모리에 접근하는 속도보다 빠르기 때문에 CPU의 연산이 끝나도 다음 연산을 위한 데이터가 메모리에서 도착하지 않으면 CPU 성능의 발전은 의미가 없어진다.
- CPU의 연산 속도와 메모리 접근 속도의 차이를 줄이기 위해 나온것이 캐시 메모리이다.
- 캐시 메모리는 CPU에서 필요할 것 같은 데이터를 메모리에서 가져다 저장해 놓는 장치이다.
- 컴퓨터 내부에는 여러개의 캐시 메모리가 있는데 이 캐시 메모리들도 CPU와 가까운 순서대로 계층을 구성하고 CPU와 가장 가까운 메모리부터 L1캐시, L2캐시,  L3캐시라고 부른다.
- CPU는 메모리 내의 데이터가 필요할 때 가까운 곳의 메모리부터 데이터를 검색한다.

### 참조 지역성 원리

- 캐시 메모리는 메모리 보다 용량이 작기 때문에 메모리에서 CPU가 사용할 법한 대상을 예측하여 저장한다.
- 예측하여 가져온 데이터가 실제로 들어맞아 캐시 메모리 내 데이터가 CPU에서 사용될 경우를 캐시 히트라고 하고, 예측이 틀려 CPU가 메모리에서 직접 데이터를 가져와야 하는 경우를 캐시 미스라고 한다.
- 캐시가 히트되는 비율을 캐시 적중률이라고 하고 캐시 적중률이 높을수록 성능이 올라간다.
- 캐시 메모리가 메모리로부터 데이터를 가져올 때 따르는 원칙을 **참조 지역성의 원리**라고 한다.
    - CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.
    - CPU는 접근한 메모리 공간 근처를 접근하려는 경향이 있다.
