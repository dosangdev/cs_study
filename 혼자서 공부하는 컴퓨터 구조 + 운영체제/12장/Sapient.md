# 12. 프로세스 동기화



## 12-1. 동기화란
### 동기화의 의미
#### 협력적으로 실행되는 프로세스들은 아무렇게나 마구 동시에 실행해서는 안되며 올바른 실행을 위해서는 동기화가 필수이다.
#### 프로세스 동기화란 프로세스 사이의 수행시기를 맞추는 것을 의미한다.
##### 수행 시기를 맞춘다는 건
> - 실행 순서 제어: 프로세스를 올바른 순서대로 실행하기
> - 상호 배제: 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기
#### 동기화에는 실행 순서 제어를 위한 동기화가 있고, 상호 배제를 위한 동기화가 있다.
#### 동시에 실행되는 프로세스를 올바른 순서대로 실행하는 것이 첫 번째 프로세스 동기화 이다.
#### 동시에 접근해서는 안 되는 자원에 동시에 접근하지 못하게 하는 것이 상호 배제를 위한 동기화이다.



### 공유 자원과 임계 구역
#### 동시에 실행되는 프로세스들이 공동의 자원을 두고 작업할 경우 그 자원을 공유 자원이라고 한다.
#### 공유 자원중에는 두 개 이상의 프로세스를 동시에 실행하면 문제가 발생하는 자원이 있는데, 이 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역을 임계 구역이라고 한다.
#### 잘못된 실행으로 인해 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우가 있는데 이를 레이스 컨디션 이라고 한다.
#### 상호 배제를 위한 동기화는 두개 이상의 프로세스가 임계 구역에 동시에 접근하지 못하도록 관리하는 것이고 이를 위해서는 세가지 원칙이 반드시 지켜져야 한다.
> - 상호 배제: 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없다.
> - 진행: 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
> - 유한 대기: 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 한다.




## 12-2. 동기화 기법
### 뮤텍스 락
#### 동시에 접근해서는 안 되는 자원에 동시에 접근하지 않도록 만드는 도구, 상호 배제를 위한 동기화 도구이다.
#### 좌물쇠 역할을 하는 전역 변수 하나와 임계 구역을 잠그는 역할, 임계 구역의 잠금을 해제하는 역할을 하는 두 개의 함수로 구현할 수 있다.
#### 임계 구역이 잠겨 있는지를 쉴 새 없이 반복해 확인하는 것을 바쁜 대기라고 한다.



### 세마포
#### 뮤텍스 락은 하나의 공유 자원에 접근하는 프로세스를 상정한 방식이고 세마포는 공유 자원이 여러 개 있는 상황에서도 적용이 가능한 동기화 도구이다.
#### 세마포는 '멈춤'신호와 '가도 좋다'는 신호로 임계 구역을 관리한다.
#### 임계 구역에 진입할 수 있는 프로세스의 개수를 나타내는 전역 변수 하나와 임계 구역에 들어가도 좋은지, 기다려야 할지를 알려주는 함수, 임계 구역 앞에서 기다리는 프로세스에 '이제 가도 좋다'고 신호를 주는 함수인 함수 두 개로 구현 할 수 있다.
#### 뮤텍스 락에도 해당되는 문제지만 공유 자원이 바쁜 경우 프로세스는 무작정 공유 자원이 있는지 확인하는 바쁜 대기를 반복해야 하고 이는 CPU 주기를 낭비한다는 점에서 손해이다.
#### 그래서 세마포는 사용할 수 있는 자원이 없을경우 프로세스 상태를 대기 상태로 만들고, 다른 프로세스의 작업이 끝나 사용할 수 있는 자원이 생기면 프로세스 상태를 준비 상태로 변경하는 방법을 사용한다.
#### 세마포를 이용하면 동시에 실행되는 프로세스의 실행 순서도 제어할 수 있다.



### 모니터
#### 공유 자원을 다루는 인터페이스에 접근하기 위한 큐(모니터에 진입하기 위한 큐)를 만들고, 모니터 안에 항상 하나의 프로세스만 들어오도록하여 상호 배제를 위한 동기화를 한다.
#### 모니터는 조건 변수를 사용하여 실행 순서 제어를 위한 동기화도 할 수 있다.
