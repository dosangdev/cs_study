# 동기화란

동기화의 개념과 동기화가 왜 필요한지 알아보자

## 동기화의 의미

- 워드 프로세스 안에는 입력을 받는 프로세스, 맞춤법 검사 프로세스, 화면 출력 프로세스 등이 있다.
- 이 프로세스들은 각기 독립적인 프로세스이지만 공동의 목표를 위해 서로 협력하는 존재이다.
- 그래서 이 협력을 위해 프로세스들이 올바르게 실행되도록 해야 한다.
- 이 때 필요한 것이 프로세스 동기화인데 사전에서는 동기화를 ‘작업들 사이의 수행시기를 맞추는 것’을 뜻한다고 한다.

### 동기화의 두가지 필수 요건

- 실행 순서 제어 : 프로세스를 올바른 순서대로 실행하기
- 상호 배제 : 동시에 접근해서는 안되는 자원에 하나의 프로세스만 접근하게 하기

### 실행 순서 제어

- 말 그대로 프로세스 간에 실행 순서를 제어하는 것이다.

### 상호 배제

- 계좌 잔액 문제
- 생산자와 소비자 문제

## 공유 자원과 임계 구역

- 계좌 잔액 문제와 생산자 소비자 문제 각각의 케이스에서 두 프로세스는 ‘잔액’과 ‘총합’이라는 공동의 자원을 두고 작업을 했다. 이러한 자원을 공유 자원이라고 한다.
- 공유 자원 중에서도 두 개의 프로세스가 동시에 작업을 하게되면 문제가 생기는 자원이 있다.
- 그리고 문제가 발생하는 공유 자원에 접근하는 코드 영역을 임계 구역이라고 한다.
- 두 개의 프로세스가 임계구역에 진입하려 한다면 둘 중 하나는 대기해야만 한다.
- 만일 잘못된 실행으로 여러 프로세스가 동시다발적으로 임계구역 코드를 실행한다면 문제가 발생할 것이고 이 문제를 레이스 컨디션 이라고 한다.

### 고급언어는 실행과정 중 저급 언어로 변환되어 실행된다.

### 임계 구역 문제를 해결하는 원칙 3가지

- 상호 배제 : 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없다.
- 진행 : 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
- 유한대기 : 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 한다.

# 동기화 기법

## 뮤테스 락

- 공유 자원이 단 한개만 있다고 가정하고 만든 도구
- 자물쇠 역할 : 전역 변수 Lock
- 잠그는 함수 : acquire
- 여는 함수 : release

### 순서

- 임계 구역에 진입하기 전 acquire 함수를 호출한다.
    - lock = false라면 잠그고 진입!
    - lock = true 라면 false가 될 때까지 확인! → 이것을 바쁜 대기라고 한다.
- 임계 구역에 진입 후 작업을 마치면 release 함수를 호출한다.

## 세마포

- 뮤테스락보다 조금 더 일반화된 방식의 동기화 도구
- 공유 자원이 여러개 있는 상황에도 적용 가능한 도구
- 임계 구역 진입 가능한 프로세스 개수 : 전역 변수 S
- 임계 구역 진입 전 가도 좋은지 알려주는 함수 : wait
- 임계 구역 진입 후 작업을 마치고 가도 좋다는 함수 : signal

### 뮤테스 락과 다른 점

- 바쁜 대기 상태에서 프로세스는 CPU 주기를 낭비하게 된다.
- 그래서 세마포는 wait함수를 약간 변형(?)해서 바쁜 대기 상태의 프로세스를 대기 상태로 만들고, 그 프로세스의 PCB를 세마포를 위한 대기 큐에 집어 넣는다.
- 그리고 작업 중이던 프로세스의 작업이 끝나고 signal 함수를 호출하면 signal 함수는 대기 중인 프로세스를 대기 큐에서 제거하고, 프로세스를 준비 상태로 변경한 뒤 준비 큐로 옮겨준다.

## 세마포로 실행 순서 제어하기

- 전역 변수 S를 0으로 둔다.
- 나중에 실행할 프로세스 앞에다 wait() 함수를 주면 S = 0이므로 임계구역에 진입하지 못한다.
- 먼저 실행할 프로세스에는 wait를 주지않아 free-pass되고, 뒤에 signal 함수를 호출하여 S가 1이 되게 해준다. 그러면 wait로 기다리던 프로세스가 들어올 수 있게 된다.

## 모니터

### 상호배제

- 공유자원 + 공유 자원에 접근하기 위한 인터페이스(통로)를 묶어 관리
- 프로세스는 반드시 인터페이스를 통해서만 공유 자원 접근 가능
- 모니터에는 항상 하나의 프로세스만 들어올 수 있다.

### 실행 순서 제어

- 조건 변수라는 것을 사용한다.
- wait와 signal 함수를 호출해서 제어한다.
- 조건 변수에 대한 큐가 있다. 모니터 내부에 진입하지 못한 프로세스들을 위한 상호 배제를 위한 큐와는 다르다.
- 조건 변수 큐는 모니터 내부로 진입했지만 실행 조건을 충족시키지 못한 프로세스들이 대기하는 큐이다. (실행 하다가 중단되고 들어가기도 한다.)
- 조건 변수 큐로 진입시키는 방법은 wait를 호출하는 것이다.
- 그리고 wait로 인해 큐로 진입한 프로세스는 다른 프로세스의 signal 신호에 큐에서 나와 실행을 재개할 수 있다.
- signal을 호출한 프로세스가 모니터를 떠난 뒤 실행 or signal을 호출한 프로세스의 실행을 잠시 중단하고 조건 변수 큐에서 복귀해서 실행된 뒤 중단된 프로세스 다시 재개