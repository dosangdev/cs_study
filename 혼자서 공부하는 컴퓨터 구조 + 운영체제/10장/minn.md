# 10장.프로세스와 스레드
 
## 프로세스의 종류
> - 포그라운드 프로세스 : 사용자가 보는 앞에서 실행되는 프로세스
> - 백그라운드 프로세스 : 사용자가 보지 못하는 뒷편에서 실행되는 프로세스
>   - 사용자와 상호작용하는 프로세스
>   - 사용자의 상호작용하지 않는 프로세스(데몬/서비스)


## 프로세스 제어 블록(PCB)
> 프로세스와 관련된 정보를 저장하는 자료구조. 프로그램이 실행될 때 커널 영역에 생성되고 프로그램 종료 시 폐기된다.

프로세스는 자신의 차례가 되면 CPU를 이용하고, 타이머 인터럽트가 발생하면 CPU 점유를 끝내고 자신의 순서를 기다린다. 이런 프로세스 교환 과정에서 필요한 것이 PBC이다.

## PCB에 들어있는 정보들
- 프로세스 ID (PID) :
특정 프로세스를 식별하기 위한 식별 번호
- 레지스터 값 : 
레지스터 - 프로세스 실행 중 사용한 데이터 값이 저장되는 곳
- 프로세스 상태 :
현재 프로세스의 상태. CPU 대기 상태인지, CPU 이용 중인지, 입출력장치 대기 중인지...
- CPU 스케줄링 정보 :
프로세스가 언제, 어떤 순서로 CPU를 할당받을지에 대한 정보
- 메모리 관리 정보 : 
프로세스의 주소 정보. 베이스 레지스터(시작 주소), 한계 레지스터(프로세스 크기), 페이지 테이블(물리 주소인 페이지 주소) ...
- 사용한 파일과 입출력 장치 목록


## 문맥 교환
> - 문맥 : 하나의 프로세스를 수행하기 다시 하기 위해 필요한 정보 (PCB에 기록되는 정보)<br>
> - 문맥 교환 : CPU를 점유하는 프로세스가 바뀌는 것

운영체제는 한 프로세스가 CPU 점유가 끝났거나, 인터럽트가 발생하면 프로세스의 문맥을 PCB에 백업한다.<br>
문맥 교환에서는 기존 프로세스의 문맥을 PCB에 백업하고, 새로운 프로세스를 위한 문맥을 PCB로부터 복구하여 새로운 프로세스를 실행한다.<br>
문맥 교환을 너무 자주 하면 오버헤드(다른 프로세스로 전환하는데 낭비되는 비용)가 발생한 수 있다.

## 프로세스의 메모리 영역
프로세스 실행 시 커널 영역이는 PCB가 생성되고, 사용자 영역에는 코드, 데이터, 힙, 스택 영역이 생성된다.
코드 영역과 데이터 영역은 정적 할당 공간, 힙 영역과 스택 영역은 동적 할당 공간이다.
- 코드 영역(텍스트 영역)<br>
    CPU가 실행할 명령어가 저장되는 영역. 읽기 전용 공간.
- 데이터 영역<br>
    프로그램이 실행되는 동안 유지할 데이터가 저장되는 영역. (ex. 전역 변수)
- 힙 영역<br>
    프로그래머가 직접 할당할 수 있는 영역. 사용 후 공간을 반환하지 않으면 메모리 누수가 발생할 수 있다. 낮은 주소 -> 높은 주소 순으로 할당.
- 스택 영역<br>
    데이터를 일시적으로 저장하는 공간. (ex. 함수 매개 변수, 지역 변수) 높은 주소에서 낮은 주소 순으로 할당.

<img width="258" alt="image" src="https://github.com/Minnie5382/devduck-cs-study/assets/97179789/90615df5-bcc5-4d0b-84df-f893c216a0ed">


## 프로세스 상태
![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/eac6cfaa-de5f-4bad-9077-f9ceb99a5ce0)

Process State Diagram
- 생성 : 이제 막 메모리에 적재되어 PCB를 할당받은 상태

- 준비 : 실행할 수 있지만, 차례가 아니어서 기다리는 상태

- 실행 : 실행중인 상태

- 대기 : 실행 도중 사용한 입출력장치의 작업이 끝나기를 기다리는 상태

- 종료 : 프로세스 종료

## 프로세스 계층 구조 

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/d3740a0b-de3e-4c5a-82b2-7f00f174f4a6)
- 부모 프로세스는 실행 도 중 다른 프로세스(자식 프로세스)를 생성할 수 있다. 이런 식으로 OS는 프로세스가 프로세스를 낳는 계층 구조(트리 구조)로 프로세스를 관리한다.

- 부모 프로세스와 자식 프로세스는 각각 다른 PID를 가지고, 운영체제에 따라 자식 프로세스의 PCB에 PPID를 기록하기도 한다.

- 컴퓨터 부팅 시 최초의 프로세스(PID=1)가 실행되고, 최초의 프로세스가 자식 프로세스를 낳고... 


## 프로세스 생성 기법
>1. 부모 프로세스는 fork 시스템 호출을 통해 자신의 복사본을 생성한다. 부모 프로세스의 자원들이 상속된다. 
>2. 자식 프로세스는 exec 시스템 호출을 통해 자신의 메모리 공간에 새로운 프로그램을 덮어써서 실행할 프로그램의 데이터로 바뀌게 한다.

##### * fork와 exec은 독립적인 시스템 호출이므로, fork 후 exec하지 않을 수 있고, fork 하지 않고 exec 할 수도 있다.
##### * fork, exec은 유닉스 기반 OS의 시스템 콜이다.

## 스레드
> 스레드 : 프로세스를 구성하는 실행 흐름의 단위

-> 한 프로세스 안에서 동시에 진행되는 여러 개의 일이 있을 때, 그 일들의 단위를 말한다.

> 단일 스레드 프로세스 : 한 프로세스가 한 번에 하나의 일만을 처리하는 것<br>
> 멀티 스레드 프로세스 : 한 프로세스가 한 번에 여러개의 일을 처리하는 것

<br>

- 스레드는 프로세스 내에서 각자 저마다의 스레드 ID, 레지스터 값, 스택 공간을 갖는다.

- 따라서 스레드는 각자 다른 코드를 실행할 수 있다.

- 그러나 그 외의 영역(코드/데이터/힙)은 모두가 공유한다.

- 최근엔 많은 운영체제가 프로세스 단위가 아닌 스레드 단위로 일을 처리한다. (Linux-task)

## 멀티 프로세스 vs 멀티 스레드

<img width="812" alt="image" src="https://github.com/Minnie5382/devduck-cs-study/assets/97179789/87d036fb-7e6e-44b1-96f1-8fe9351919c8">


>  멀티 프로세스 <br>
>여러 개의 프로세스가 동시에 실행되는 것. 기본적으로 자원을 공유하지 않는다.
> 메모리의 낭비가 있을 수 있다.
>
> 멀티 스레드<br>
>여러 개의 스레드가 동시에 실행되는 것. 스레드끼리 프로세스의 자원을 공유한다.
> 메모리를 효율적으로 사용하고, 스레드끼리 협력과 통신에 유리하지만 하나의 스레드에 문제가 생기면 프로세스 전체에 영향을 줄 수 있다.

##### * 프로세스 간 자원 공유가 불가능한건 아니다. 프로세스 간 통신(IPC)에는 파일을 통한  IPC, 공유 메모리, 소켈, 파이프 등이 있다.

