# 입출력장치

## 08-1. 장치 컨트롤러와 장치 드라이버

### 장치 컨트롤러

- 입출력장치는 종류가 너무 많아 정보를 주고받는 방식을 규격화 하기가 어렵다. 또, CPU와 메모리, 입출력 장치간의 전송률의 차이가 통신을 어렵게 하기 때문에 다른 장치보다 다루기가 까다롭다.
- 입출력장치는 컴퓨터와 직접 연결되지 않고 장치 컨트롤러라는 하드웨어를 통해 연결되고 이 장치 컨트롤러는 하나 이상의 입출력장치와 연결되어 입출력장치가 컴퓨터 내부와 정보를 주고받게 한다.
- 장치 컨트롤러의 역할
    - CPU와 입출력장치 간의 통신 중개
    - 오류 검출
    - 데이터 버퍼링
        
        > 데이터 버퍼링이란 전송률이 높은 장치와 낮은 장치 사이에 주고받는 데이터를 버퍼라는 임시 저장 공간에 저장하여 전송률을 비슷하게 맞추는 방법. 쉽게 말해 버퍼에 데이터를 조금씩 모았다가 한꺼번에 내보내거나, 데이터를 한 번에 많이 받아 조금씩 내보내는 방법이다.
        > 
- 장치 컨트롤러의 내부 구조(실제로는 더 복잡함)
    - 데이터 레지스터: CPU와 입출력장치 사이에 주고받을 데이터가 담기는 레지스터. 버퍼 역할을 한다. 최근에는 레지스터 대신 RAM을 사용하기도 함
    - 상태 레지스터: 입출력장치가 작업을 할 준비가 되었는지, 작업이 완료되었는지, 오류는 없는지 등의 상태 정보가 저장됨
    - 제어 레지스터: 입출력장치가 수행할 내용에 대한 제어 정보와 명령을 저장한다.
    - 레지스터들에 담긴 값들은 버스를 타고 CPU나 다른 입출력장치로 전달되기도 하고, 장치 컨트롤러에 연결된 입출력장치로 전달된다.

### 장치 드라이버

- 장치 드라이버는 장치 컨트롤러의 동작을 감지하고 제어함으로써 장치 컨트롤러가 컴퓨터 내부와 정보를 주고 받을 수 있게하는 프로그램이다.
- 프로그램이므로 실행 과정에서 메모리에 저장된다.

## 08-2. 다양한 입출력 방법

### 프로그램 입출력

- 프로그램 입출력은 기본적으로 프로그램 속 명령어로 입출력장치를 제어하는 방법이다.
- CPU가 프로그램 속 명령어를 실행하는 과정에서 입출력 명령어를 만나면 CPU는 입출력장치에 연결된 장치 컨트롤러와 상호작용하며 입출력 작업을 수행한다.
- CPU가 장치 컨트롤러 속 레지스터들을 인식하는 방법은 메모리 맵 입출력과 고립형 입출력 두 가지가 있다.
    - 메모리 맵 입출력: 메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 방법
    - 고립형 입출력: 메모리를 위한 주소 공간과 입출력장치를 위한 주소 공간을 분리하는 방법.

### 인터럽트 기반 입출력

- CPU가 장치 컨트롤러에 입출력 작업을 명령하고, 장치 컨트롤러가 입출력장치를 제어하며 입출력을 수행하는 동안 CPU는 다른일을 할 수 있다.
- 장치 컨트롤러가 입출력 작업을 끝낸 뒤 CPU에게 인터럽트 요청 신호를 보내면 CPU는 하던일을 잠시 백업하고 인터럽트 서비스 루틴을 실행한다.
- 인터럽트가 여러 장치에서 동시에 발생할 경우 컴퓨터는 프로그래머블 인터럽트 컨트롤러라는 하드웨어를 사용하여 인터럽트의 우선순위를 판별하여 우선순위에 따라 인터럽트를 처리한다.

### DMA 입출력

- 입출력 장치와 메모리가 CPU를 거치지 않고도 상호작용할 수 있는 입출력 방식이다. 직접 메모리에 접근할 수 있는 입출력 기능이다.
- DMA 입출력을 하기 위해서 시스템 버스에 연결된 DMA 컨트롤러라는 하드웨어가 필요하다.

**DMA 입출력 과정**

1. CPU는 DMA 컨트롤러에 입출력장치의 주소, 수행할 연산, 읽거나 쓸 메모리의 주소 등과 같은 정보로 입출력 작업을 명령한다.
2. DMA 컨트롤러는 CPU 대신 장치 컨트롤러와 상호작용하며 입출력 작업을 수행한다. 이때 DMA 컨트롤러는 필요한 경우 메모리에 직접 접근하여 정보를 읽거나 쓴다.
3. 입출력 작업이 끝나면 DMA 컨트롤러는 CPU에 인터럽트를 걸어 작업이 끝났음을 알린다.

**입출력 버스**

- 시스템 버스는 공용 자원이라 DMA 컨트롤러와 CPU가 동시에 사용할 수 없다. 당연히 DMA 컨트롤러가 시스템 버스를 너무 자주 사용하면 그만큼 CPU가 시스템 버스를 이용하지 못한다.
- 이 문제를 해결하기위해 DMA 컨트롤러와 장치 컨트롤러들을 입출력 버스라는 별도의 버스에 연결한다.
- 장치 컨트롤러들이 시스템 버스가 아닌 입출력 버스에 연결됨으로써 시스템 버스의 사용 빈도를 줄일 수 있다.
