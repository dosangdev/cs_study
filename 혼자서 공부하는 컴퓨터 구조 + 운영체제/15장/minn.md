# 15장. 파일 시스템
## 15-1. 파일과 디렉토리

#### 파일
> 파일 : 보조기억장치에 저장된 관련 정보의 집합<br>
> → 우리가 알고있는 그거, 데이터 뭉텅이.

- 파일을 이루는 정보에는 파일의 이름, 정보, 메타데이터(속성, 부가 정보)등이 있다.
- 속성 : 유형, 위치(경로), 크기, 생성일, 수정일, 형식 ...
- 파일의 유형은 파일의 종류를 의미한다. ex) 음악, 영상, 문서 ...
- 파일의 유형을 나타내는 가장 쉬운 방법은 확장자이다. ex) mp3, avi, doc ...
- 대표적인 확장자
  |파일 유형|대표적인 확장자|
  |-|-|
  |실행 파일|없음, exe|
  |목적 파일|obj, o|
  |소스 코드 파일|js, java, c|
- OS는 파일의 생성, 삭제, 열기, 닫기, 읽기, 쓰기 등 파일을 다루기 위한 시스템 호출을 제공한다.

#### 디렉토리
> 윈도우에서의 폴더의 개념.

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/c2ed29ba-27cb-4e51-b667-7c4eace0af26)


- OS는 트리 구조로 디렉토리를 관리한다.
- 최상위 디렉토리는 루트(root)라고 하고, `/` 로 표현
- 이 디렉토리를 이용해 파일의 위치를 나타내는 것을 경로(path)라고 한다.

> 절대 경로 : 루트부터 파일까지의 풀 주소. (/etc/bin/php)
> 
> 상대 경로 : 내가 있는 디렉토리부터 파일까지의 일부 주소 (./bin/php)
###### *윈도우에서는 구분자로 / 대신 \를 사용한다.
###### *상대 경로에서 내가 있는 디렉토리는 `.` 상위 디렉토리는 `..`으로 나타낸다.

- OS는 디렉토리 안에 있는 파일의 정보가 담긴 디렉토리 테이블을 만들어 관리하며, 이런 디렉토리 테이블을 OS는 디렉토리로 간주한다.
- 디렉토리 테이블 엔트리에는 각각의 파일 이름, 위치를 유추할 수 있는 정보 등이 담긴다.


## 15-2. 파일 시스템
#### 파티셔닝 & 포매팅
> 파티셔닝 : 보조기억장치의 전체 영역을 가상의 구역(파티션)으로 나누는 작업
>
> 포매팅 : 파일 시스템을 설정하고, 새로운 데이터를 쓸 준비를 하는 작업

- 파티션마다 다른 파일 시스템을 설정할 수도 있다.

#### 파일 할당 방법

- 하드디스크의 최소 단위는 섹터이지만, 섹터는 너무나 작아서 여러 개의 섹터를 하나의 블록으로 묶는다.
- OS는 파일과 디렉토리를 **블록 단위**로 읽고 쓴다.
- 크기에 따라 저장되는 블록의 개수가 달라진다.

### 1. 연속 할당
> 보조기억장치 내 연속적인 블록에 파일을 할당하는 단순한 방법

- 파일에 접근하기 위해선 **파일의 첫 번째 블록 주소**와 **블록 길이**만 알면 된다.
- 기억장치 내에서 외부 단편화를 야기한다.


### 2. 연결 할당
> 파일을 이루는 블록을 연결 리스트*로 관리하는 방법
> ###### *연결 리스트 : 각 블록에 다음 블록의 주소를 함께 저장하여 각 블록이 다음 블록을 가리키게 하는 것

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/1bcd81a4-e0c1-4a7b-a84d-dc742043b750)

- 각 블록의 일부에 다음 순서로 오는 블록의 주소를 저장하고 있다. 즉, 각 블록에 자기 다음에 올 블록을 가리키고 있다.
- 마지막 블록에는 끝을 의미하는 특정 표시자가 들어간다 (-1)
- 단점 1. 파일의 중간 부분을 접근하려 해도 반드시 첫번째 블록부터 차례대로 읽어야 하므로 임의 접근 속도가 매우 느리다.
- 단점 2. 한 블록이 손상되면 그 이후 블록들에는 접근할 수 없다.
  
➡️ 단점을 보완한 것이 FAT!

#### FAT(File Allocation Table) 파일 시스템

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/b0bc78cf-3936-4200-b8f3-cf984a04e70d)

- 각 블록에 다음 블록의 주소를 지정했기 때문에 문제가 발생한 것이기 때문에, FAT 파일 시스템에서는 다음 블록의 주소를 한데 모아서 테이블(FAT)로 관리한다.
- 디렉토리 테이블(FAT)의 엔트리에 각 블록 주소와 다음 블록 주소가 담기고, 추가로 확장자, 속성, 생성일시... 등 메타데이터가 담긴다.
- 연결 할당과 같이, 마지막 블록에서는 특정 표시자를 표기한다. (-1)
- 옛날 MS-DOS, USB 메모리, SD 카드 등 저용량 저장 장치에서 흔히 사용된다.
- FAT12, FAT16, FAT32 등의 버전이 있는데, 각각의 숫자는 블록의 비트 수를 의미한다.
<br><br>
- FAT 파일시스템에서는 파티션이 다음과 같이 구성된다.

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/0af39e12-1229-48b8-bb2b-f31dadf43f3b)

- FAT 영역에 FAT이 저장된다.
- 실행 도중 FAT가 메모리에 캐시될 수 있는데, 이럴 경우 임의 접근의 성능이 개선된다.


### 3. 색인 할당
> 파일의 모든 블록 주소를 하나의 색인 블록에 모아서 관리하는 방식

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/77aa0848-32e2-4f66-85db-4522d0a9e635)

- 위 그림에서, f2 파일을 읽고 싶다면 f2 파일의 색인 블록인 27번 블록에 저장된 블록을 순서대로 읽으면 된다. (21→4)
- 색인 블록만 읽으면 되기 때문에 임의 접근 시간이 짧다.

➡️ 색인 할당 방식을 변형한 것이 유닉스 파일 시스템!

#### 유닉스 파일 시스템
- 색인 블록을 i-node라고 명명한다.
- i-node에는 15개까지 블록을 저장할 수 있다.
- 15개를 초과하는 블록은 단일 간접 블록, 이중 간접 블록, ... 을 이용해 저장 공간을 확장한다.
- 디렉토리 엔트리에느 파일 이름과 i-node 번호가 담긴다.

#### 공간 확장 과정
1. 12개까지는 그냥 블록 주소를 저장한다.
2. 그 이상 초과하는 경우, 13번째 블록에는 단일 간접 블록의 주소를 저장한다.
3. 그 이상 초과하는 경우, 14번째 블록에는 이중 간접 블록*의 주소를 저장한다.
    * 이중 간접 블록 : 단일 간접 블록을 가리키는 블록
4. 그 이상 초과하는 경우, 15번째 블록에는 삼중 간접 블록*의 주소를 저장한다.
    * 삼중 간접 블록 : 이중 간접 블록을 가리키는 블록

<img src='https://github.com/Minnie5382/devduck-cs-study/assets/97179789/6b25d08b-674b-44da-99cc-4d1c45e9af4c' width='600px'>

4KB 블록에 파일 포인터가 32비트(4바이트)인 경우 `(12 + 1K + 1M + 1G) * 4KB ≈ 4TB` 까지 저장공간을 확장할 수 있다.


#### 저널링 파일 시스템
> 작업 시 로그를 남기고, 작업이 끝나면 로그를 삭제하는 저널링 기법을 사용해 시스템 크래시* 발생 시 로그를 통해 빠르게 복구할 수 있도록 하는 시스템
###### * 시스템 크래시 : 치명적인 오류로 인해 파일 작성 도중 컴퓨터가 강제로 꺼져버리는 상황

- 저널링 기법에서는 1.작업 직전 로그 영역에 수행하려는 작업에 대한 로그를 남기고 2. 작업이 완료되면 로그를 삭제한다.
- 따라서 시스템 크래시가 발생하면 로그 영역에 있는 로그만 검사하여 어떤 작업을 수행중이었는지 알아내고, 해당 작업을 완료하면 복구할 수 있다.
- 마이크로소프트의 NT 파일 시스템, 리눅스의 ext3, ext4 파일 시스템 등 대부분의 파일 시스템에서 지원한다.

#### 마운트
> 한 저장 장치의 파일 시스템에서 다른 저장 장치의 파일 시스템에 접근할 수 있도록 연결하는 것

<img src='https://github.com/Minnie5382/devduck-cs-study/assets/97179789/aaf02812-7028-49ca-9f56-34b943aeb29e' width='900px'>

<img src='https://github.com/Minnie5382/devduck-cs-study/assets/97179789/0c960577-cb14-4f55-8eb9-848f620bcafd' width='700px'>


