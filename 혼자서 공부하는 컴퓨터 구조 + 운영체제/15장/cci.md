# 파일과 디렉터리

## 파일

파일은 의미 있고 관련 있는 정보를 모은 논리적 단위를 일컫는 말이다.

### 파일을 이루는 정보

파일 이름 + 파일을 실행하기 위한 정보 + 속성(메타 데이터)(파일 부가정보)

### 파일 속성과 유형

- 속성 : 유형, 크기, 수정된 날짜 등 파일 속성에서 볼 수 있는 것들. 운영체제마다 조금씩 다르다.
- 유형 : 운영체제가 인식하는 파일 종류. (실행파일, 워드파일 등) (exe, xml, doc 등)

### 파일 연산을 위한 시스템 호출

파일을 다루는 모든 작업은 운영체제에 의해 이루어진다. 그래서 어떤 응용 프로그램이 파일을 다루기 위해선 운영체제에게 부탁을 해야 하는데 이 부탁을 바로 시스템 호출이라고 한다.

- 생성, 쓰기, 삭제, 읽기 등이 있다.

## 디렉터리

파일들을 일목요연하게 다루기 위해 사용하는 ‘특별한 형태의 파일’

### 1단계 디렉터리 → 트리 구조 디렉터리

운영체제가 탄생한 초기에는 많은 데이터를 수용하지 않았기에 디렉터리 하나로 모든 것을 처리했지만, 시간이 지나 데이터들이 많아지면서 하나의 디렉터리로 파일들을 관리하는게 어려워졌다. 그래서 트리 구조로 여러 디렉터리가 뻗어 나가있는 형태로 진화했다.

- 최상위에 있는 디렉터리 : 루트 디렉터리
- 그 아래로 디렉터리 들이 가지처럼 쭉 뻗어 있는 형태
    - 그러다 보니 경로(path)가 자연스레 생겨났다.

### 절대 경로와 상대 경로

- 절대 경로 : **루트 디렉터리**로부터 각각의 파일까지 경로가 다르다. 동일한 파일 이름이여도 다른 디렉터리에 있다면 공존할 수 있는 것이 바로 이 고유한 경로 (절대 경로)가 다르기 때문이다.
- 상대 경로 : **현재 디렉터리**로부터 시작하는 경로

### 디렉터리 연산을 위한 시스템 호출

- 디렉터리 쓰기, 생성, 읽기 등이 있다.

## 디렉터리 엔트리

디렉터리는 디렉터리 안에 담겨있는 대상들에 대한 정보를 가지고 있다. 그리고 이 정보는 보조기억장치에 표(테이블)형태로 저장된다.

### 디렉터리 엔트리에서 알 수 있는 정보

**공통**

- 포함된 대상의 이름
- 보조기억장치 내 어디에 저장되어있는지 유추

**파일 시스템 마다 차이가 있다.**

# 파일 시스템

파일과 디렉터리를 일목요연하게 저장하고 관리할 수 있게 하는 운영체제의 내부 프로그램이다.

## 파티셔닝과 포매팅

보조기억장치를 처음에 사용하기 위해서는 2가지 필수 작업이 필요하다.

- 파티셔닝 : 파일이나 폴더를 다루기 위해 구역을 논리적으로 나누는 작업
- 포매팅 : 파일 시스템을 설정하는 작업
    - 각 파티션마다 다른 파일 시스템을 설정할 수 있다.

## 파일 할당 방법

- 운영체제는 파일과 디렉터리를 블록 단위로 읽는다.
- 블록 안에는 블록의 위치를 식별할 수 있는 주소가 적혀있다.
- 파일을 보조기억장치에 할당하는 방법으로는 크게 연속 할당과 불연속 할당이 있다.
    - 불연속 할당에는 연결 할당과 색인 할당이있다.

**참고**

물론 보조기억장치의 가장 작은 단위는 섹터이지만 운영체제는 하나 이상의 섹터를 묶어 블록단위로 파일과 디렉터리를 관리한다.

### 연속할당

- 가장 단순한 방식이다.
- 파일을 순서대로 하나씩 저장시키는 것이다.
- 디렉터리 엔트리에는 파일의 주소와 파일이 차지하는 블록의 길이를 적으면 된다.

**단점**

차곡차곡 쌓여있지만 중간중간 파일이 삭제되어버리면 외부 단편화가 발생한다.

### 연결 할당

각 블록 일부에 다음 블록의 주소를 저장하여 순서대로 블록을 할당하는 방법. 즉 연결 리스트로 관리한다.

**예시 (참조)**

**단점**

- 순서대로 다음 블록을 가리키고 있기 때문에 반드시 처음부터 하나씩 차례대로 읽어야 한다.
    - 그래서 파일의 임의의 위치에 접근하는 속도가 매우 느리다.
- 하드웨어 고장이나 오류 발생 시 해당 블록 이후 블록은 접근할 수 없다.
    - 어떤 블록 하나에만 오류가 생겨도 그 이후의 블록은 접근을 아에 할 수 없다.

### 색인 할당

- 파일의 모든 블록 주소를 색인 블록이라는 하나의 블록에 모아 관리하는 방식이다.
- 디렉터리 엔트리에 각 파일의 색인 블록 주소가 꼭 있어야 한다.

## 파일 시스템 살펴보기

### FAT 파일 시스템

- 파일 할당 테이블(블록과 다음 블록의 주소를 한데 모아 테이블 형태로 관리)로 연결 할당의 문제점을 개선한 파일 시스템
- 최근까지 USB 메모리, SD 카드와 같은 저용량 저장 장치용 파일 시스템으로 이용중

### FAT 파일 시스템은 파티션의 앞부분에서 만들어진다.

- 예약 영역 → FAT 영역 → 루트 디렉터리 영역 → 데이터 영역
- 실행하는 도중 FAT가 메모리에 캐시될 수 있다. 메모리에 적재된 채 실행되면 기존 연결 할당보다 다음 블록을 찾는 속도가 매우 빨라진다.

### FAT 파일 시스템 예시 (그림 참조)

### 유닉스 파일 시스템

- 색인 할당 기반의 파일 시스템
- 유닉스에서는 색인 블록을 i-node라고 부른다.
- i-node는 파일 속성 정보와 열다섯 개의 블록 주소가 저장될 수 있다.
- i-node마다 번호가 부여되어 있다.
- i-node들은 파티션 내 특정 영역에 모여있다.

### i-node는 하나당 블록 개수가 유한하다.

## 해결책

1. 첫 12개에는 파일 데이터가 저장된 블록 주소가 직접적으로 저장된다. 
    1. 파일 데이터가 저장된 블록을 직접 블록 / 그 주소를 직접 블록 주소라고 한다.

1. 처음 내용으로 충분하지 않다면 열 세 번째 주소에 단일 간접 블록 주소를 저장한다.
    1. 단일 간접 블록이란 파일 데이터가 저장된 블록이 아닌 파일 데이터를 저장한 블록 주소가 저장된 블록을 의미한다.
2. 둘째로도 충분하지 않다면 열 네번째 주소에 이중 간접 블록 주소를 저장한다.
    1. 이중 간접 블록이란 데이터 블록 주소를 저장하는 블록 주소가 저장된 블록을 의미한다.
3. 마지막으로 충분치 않다면 열다섯 번째 주소에 삼중 간접 블록 주소를 저장한다.
    1. 삼중 간접 블록이란 이중 간접 블록 주소가 저장된 블록이다.