# 파일 시스템

## 15-1 파일과 디렉터리

### 파일

- 하드 디스크나 SSD와 같은 보조기억장치에 저장된 관련 정보의 집합을 의미(논리적 단위)
- 파일을 이루는 정보

  - 이름과 파일을 실행하기 위한 정보
  - 파일 관련 부가 정보(=속성, 메타데이터)

    - 파일 속성

      - 속성

        | 속성 이름        | 의미                                                               |
        | ---------------- | ------------------------------------------------------------------ |
        | 유형             | 운영체제가 인지하는 파일의 종류를 나타낸다.                        |
        | 크기             | 파일의 현재 크기와 허용 가능한 최대 크기를 나타낸다.               |
        | 보호             | 어떤 사용자가 해당 파일을 읽고, 쓰고, 실행할 수 있는지를 나타낸다. |
        | 생성 날짜        | 파일이 생성된 날짜를 나타낸다.                                     |
        | 마지막 접근 날짜 | 파일에 마지막으로 접근한 날짜를 나타낸다.                          |
        | 마지막 수정 날짜 | 파일이 마지막으로 수정된 날짜를 나타낸다.                          |
        | 생성자           | 파일을 생성한 사용자를 나타낸다.                                   |
        | 소유자           | 파일을 소유한 사용자를 나타낸다.                                   |
        | 위치             | 파일의 보조기억장치상의 현재 위치를 나타낸다.                      |

        - 유형

          | 파일 유형         | 대표적인 확장자      |
          | ----------------- | -------------------- |
          | 실행 파일         | 없는경우,exe,com,bin |
          | 목적 파일         | obj,o                |
          | 소스 코드 파일    | c,cpp,cc,java,asm,py |
          | 워드프로세서 파일 | xml,rtf,doc,docx     |
          | 라이브러리 파일   | lib,a,so,dll         |
          | 멀티미디어 파일   | mpeg,mov,mp3,mp4,avi |
          | 백업/보관 파일    | rar,zip,tar          |

    - 파일 연산을 위한 시스템 호출
      - 파일을 다루는 모든 작업은 운영체제에 의해 이뤄진다.
      - 어떤 응용프로그램도 임의로 파일 조작x -> 운영체제에 부탁해야한다.
      - 운영체제는 다음과 같은 시스템 호출을 제공한다.
        - 파일 생성,삭제,열기,닫기,읽기,쓰기

### 디렉터리

    파일들을 관리하기 위해 디렉터리를 이용한다.
    윈도우에선 폴더라고 부른다.

- 1단계 디렉터리(Single-level directory): 모든 파일이 하나의 디렉터리 아래에 있는 구조

  - 옛날 운영체제 방식
  - 컴퓨터 용량이 커지면서 저장할 수 있는 파일이 많아지고 1단계 디렉터리로는 많은 파일 관리가 어렵기 떄문에 트리 구조 디렉터리가 생겨남
    ![1단계디렉터리img] (https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdHDJyX%2FbtqCl9nL1XD%2FLpku6PDmU7HCX2iwaMRPYK%2Fimg.png)

- 트리구조 디렉터리

  - root directory(/)가 있고 그 아래 여러 자식 디렉터리가 있을 수 있다. 또 그 자식들은 여러 자식 디렉터리를 가질 수 있다.
  - 그러다보니 **경로**라는 개념 이 생겼고 경로는 파일위치, 파일 이름을 특정 짓는 정보이다.
    ![트리구조디렉터리img] (https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fea0rY3%2FbtqCsGK0lGB%2FU0NWirm8NbBfx218VjzAfK%2Fimg.png)

- 절대 경로와 상대 경로

  - 절대경로: 루트 디렉터리에서 자기 자신까지 이르는 고유한 경로
  - 상대경로: 현재 디렉터리부터 시작하는 경로

- 디렉터리 연산을 위한 시스템 호출
  - 운영체제가 디렉터리 연산을 위한 시스템 호출을 제공한다.
    - 디렉터리 생성, 삭제, 열기, 닫기, 읽기
- 디렉터리 엔트리

  - 디렉터리는 내부에 해당 디렉터리에 담겨있는 대상과 관련된 정보를 담고 있고, 이건 보통 테이블 형태로 구성된다. 즉, 디렉터리는 보조기억장치에 테이블 형태의 정보로 저장된다.
  - 각각의 엔트리에 담기는 정보는 파일 시스템마다 차이가 있다.
  - 파일시스템을 막론하고 디렉터리 엔트리가 공통으로 포함하는 정보가 있다면 그것은 디렉터리에 포함된 대상의 이름과 그 대상이 보조기억장치 내에 저장된 위치를 유추할 수 있는 정보가 담긴다.
  - 파일 시스템에 따라 디렉터리 엔트리에 파일이름, 위치를 유추할 수 있는 정보, 생성 시간 등등 파일 속성을 명시하는 경우도 있다.

  <hr/>

## 15-2 파일 시스템

### 파티셔닝과 포매팅

    한 번도 사용된 적 없는 새 하드디스크나 SSD가 있을 때 이 보조기억장치에 곧바로 파일 생성하거나 저장을 하려면
    파티셔닝과 포매팅을 거쳐야한다.

- 파티셔닝: 저장 장치의 논리적인 영역을 구획하는 작업
  - 파티션: 파티셔닝 작업을 통해 나누어진 영역 하나하나
- 포매팅: 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지 결정하고, 새로운 데이터를 쓸 준비를 하는 작업. 즉, 어떤 종류의 파일 시스템을 사용할지는 이때 결정난다.
  - 저수준 포매팅: 저장 장치를 생성할 당시 공장에서 수행되는 물리적인 포매팅
  - 논리적 포매팅: 파일 시스템을 생성하는 포매팅(책에서 설명하는 포매팅)

### 파일 할당 방법

    운영체제는 파일과 디렉터리를 **블록**단위로 읽고 쓴다.
    하나의 파일이 보조기억장치에 저장될 때는 하나 이상의 블록에 걸쳐 저장된다.
    운영체제는 하나 이상의 섹터를 블록이라는 단위로 묶은 뒤 블록 단위로 파일과 디렉터리를 관리한다.
    하드디스크 내에 여러 블록이 있다고 가정해보고 블록엔 번호가 있다.
    번호는 블록의 위치를 식별하는 주소고 이 블록에 우리가 사용하는 파일을 할당해야 한다.
    크기가 작은 파일은 적은 수의 블록에 걸쳐 저장될 것이고, 크기가 큰 파일은 여러 블록에 걸쳐 저장된다.

- 파일을 보조기억장치에 할당하는 방법

  - 연속 할당: 파일이 저장 장치 내에서 연속적인 공간을 차지하도록 블록을 할당하는 방법
    - 구현이 단순하지만, 외부 단편화를 야기한다.
  - 불연속 할당(오늘날까지 사용되는 방식)

    - 연결 할당: 각 블록 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당하는 방식(연속할당의 문제를 해결)

      - 파일이 여러 블록에 흩어져 저장되어도 무방
      - 장점: 외부 단편화 문제를 해결
      - 단점
        - 반드시 첫번째 블록부터 하나씩 차례대로 읽어야 한다.
          - 임의 접근 속도가 매우 느리다(성능 면에서 매우 비효율적)
        - 하드웨어 고장이나 오류 발생 시 해당 블록 이후 블록은 접근할 수 없다.
      - -> 오늘날에는 약간 변형을 해서 **FAT파일 시스템**을 이용한다.

      - FAT파일 시스템

        - 각 블록에 포함된 다음 블록의 주소들을 한데 모아 **파일 할당 테이블**(FAT)로 관리한다.(파일의 첫번째 블록 주소만 알면 파일의 데이터가 담긴 모든 블록에 접근 가능)
        - MS-DOS에서 사용되었고 최근까지 USB 메모리, SD카드와 같은 저용량 저장 장치용 파일 시스템으로 많이 이용된다.
        - 버전에 따라 FAT12, FAT16, FAT32가 있으며, 뒤에 오는 숫자는 블록을 표현하는 비트 수를 의미한다.
        - 파티션의 구성
          - 예약 영역(부트 섹터) - FAT영역 - 루트 디렉터리 영역 - 데이터 영역 순으로 구성
          - FAT는 하드 디스크 파티션의 시작부분에 있지만 실행하는 도중 FAT가 메모리에 캐시될 수 있다. 즉, FAT가 메모리ㅔㅇ 적재된 채 실행되면 임의 접근의 성능이 개선된다.
        - 디렉터리들은 다음과 같은 형식으로 블록에 저장된다
          - 파일이름 - 확장자 - 속성 - 예약영역 - 생성시간 - 마지막 접근시간 등등

        cf. 부트 섹터(Boot Sector)
        이 영역에는 파일 시스템을 인식하고 사용하기 위한 기본 정보가 포함되어 있습니다. 이 정보에는 파일 시스템의 유형, 클러스터의 크기, FAT의 위치 및 크기, 루트 디렉터리의 위치 등이 포함됩니다.
        또한, 부트스트랩 로더(Bootstrap Loader) 코드가 포함되어 있을 수 있습니다. 이 코드는 운영 체제를 로드하는 데 사용됩니다.

    - 색인 할당: 파일의 모든 블록 주소를 **색인 블록**에 모아 관리하는 방식

      - 파일 내 임의의 위치에 접근하기 쉽다.
      - 디렉터리 엔트리에 파일 이름과 더불어 **색인 블록 주소**를 명시한다.
      - 색인 할당을 기반으로 만든 파일 시스템이 **유닉스 파일 시스템**이다.

      - 유닉스 파일 시스템
        - 유닉스 파일 시스템에서 색인 블록을 **i-node**라고 부른다
        - 파일마다 i-node가 있고 i-node마다 번호가 부여돼있다. 그리고 i-node들은 다음과 같이 파티션 내 특정 영역에 모여 있다.
          - 예약 영역 - i-node - 데이터 영역
        - i-node 하나는 기본적으로 15개의 블록 주소를 저장할 수 있기 때문에 20, 30, 그 이상 차이하는 큰 파일은 i-node하나만으로 모두 가리킬 수 없다.
          - 해결 방법
            - 첫째, 블록 주소 중 12개에는 **직접 블록 주소**를 저장한다.
            - 둘째, '첫째'내용으로 충분하지 않다면 13번째 주소에 **단일 간접 블록 주소**를 저장합니다.
            - 셋째, '둘째'내용으로 충분하지 않다면 14번째 주소에 **이중 간접 블록 주소**를 저장합니다.
            - 넷째, '셋째'내용으로 충분하지 않다면 15번째 주소에 **삼중 간접 블록 주소**를 저장합니다.
        - 유닉스 파일 시스템의 디렉터리 엔트리엔 i-node 번호와 파일 이름으로 구성된다(i-node만 알면 파일 속성뿐만 아니라 파일 데이터를 모두 가리킬 수 있기 때문).
