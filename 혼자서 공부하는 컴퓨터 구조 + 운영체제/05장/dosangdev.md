# CPU 성능 향상 기법

## 빠른 CPU를 위한 설계 기법

### 클럭

- CPU가 클럭 신호에 맞춰 움직인다.
- 일반적으로 클럭 속도가 높은 CPU는 성능이 좋다
- 클럭속도는 Hz단위로 측정한다.
- CPU는 고성능을 요하는 순간에는 순간적으로 클럭 속도를 높이고, 그렇지 않을 땐 유연하게 클럭 속도를 낮추기도 한다. 강제적으로 최대 클럭 속도를 높일 수 있는데 이런 기법을 오버클럭킹이라고 한다.

### 코어와 멀티코어

    클럭 속도를 높이는 방법 외에 CPU 성능을 높이는 방법으로 대표적으로 CPU의 코어와 스레드 수를 늘리는 방법이 있다

- 코어: 명령어를 실행하는 부품
  - 코어를 여러 개 포함하고 있는 CPU를 **멀티코어CPU** 또는 **멀티코어 프로세서**라고 한다.
  - CPU의 연산 속도는 꼭 코어 수에 비례하여 증가하지는 않는다.
  - 코어마다 처리할 명령어들을 얼마나 적정하게 분배하느냐에 따라 연산속도가 크게 달라진다.

| 코어 수 | 프로세서 명칭 |
| ------- | ------------- |
| 1       | 싱글코어      |
| 2       | 듀얼코어      |
| 3       | 트리플코어    |
| 4       | 쿼드코어      |
| 6       | 헥사코어      |
| 8       | 옥타코어      |
| 10      | 데카코어      |
| 12      | 도데카코어    |

- 듀얼코어~도데카코어까지 멀티코어이다.

### 스레드와 멀티스레드

- 스레드: 실행 흐름의 단위
  - 하드웨어적 스레드: CPU에서 사용
    - 하나의 코어가 동시에 처리하는 명령어 단위
    - 하나의 코어로 여러 명령어를 동시에 처리하는 CPU를 **멀티스레드 프로세서** 또는 **멀티스레드 CPU**라 한다.
      - 멀티스레드 프로세서의 핵심은 레지스터이다.
    - 하이퍼스레딩: 인텔의 멀티스레드 기술
  - 소프트웨어적 스레드: 프로그램에서 사용
    - 하나의 프로그램에서 독립적으로 실행되는 단위

## 명령어 병렬 처리 기법

    빠른 CPU를 만들기 위해서 높은 클럭 속도, 멀티 코어, 멀티스레드를 지원하는 CPU를 만드는 것도 중요하지만
    CPU가 놀지 않고 시간을 알뜰하게 쓰며 작동하는 것도 중요하기 때문에 명령어 병렬 처리 기법을 알아보자
    병렬 처리 기법에는 명령어 파이프 라이닝, 슈퍼스칼라, 비순차적 명령어 처리가 있다.

### 명령어 파이프 라인

- 명령어 처리 과정

  - 1.명령어 인출
  - 2.명령어 해석
  - 3.명령어 실행
  - 4.결과 저장

- 같은 단계가 겹치지만 않는다면 CPU는 각 단계를 동시에 실행할 수 있다.
- 이처럼 공장 생산 라인과 같이 명령어들을 명령어 파이프라인에 넣고 동시에 처리하는 기법을 명령어 파이프라이닝이라고 한다.
- 특정상황에서는 성능향상에 실패하는 경우를 파이프라인 위험이라고 한다.
  - 파이프라인 위험의 종류
    - 데이터 위험: 데이터 의존성에 의해 발생
      - 어떤 명령어는 이전 명령어를 끝까지 실행해야만 실행할 수 있는 경우가 있다. 예를 들어 명령어1과 2가 있으면 2는 1이 수행되어야만 실행되는 경우를 보면 1이 실행되기 전에 2를 인출하면 이상한 값이 나올 수 있다.
    - 제어 위험: 주로 분기 등으로 인한 프로그램 카운터의 갑작스러운 변화에 의해 발생
    - 구조적 위험(= 자원 위험): 명령어들을 겹쳐 실행하는 과정에서 서로다른 명령어가 동시에 CPU 부품을 사용하려고 할 때 발생한다.

### 슈퍼스칼라

- CPU 내부에 여러 개의 명령어 파이프라인을 포함한 구조를 슈퍼스칼라 라고 한다.
- 슈퍼스칼라 구조로 명령어 처리가 가능한 CPU를 **슈퍼스칼라 프로세서** 또는 **슈퍼스칼라CPU**라고 한다.
- 이론적으로 파이프라인 개수에 비례하여 프로그램 처리 속도가 빨라진다.
  - 하지만 하나의 파이프라인을 사용할 때보다 데이터 위험, 제어 위험, 자원 위험을 피하기가 더 까다롭다(고도로 설계돼야함).

### 비순차적 명령어 처리

- 비순차적 명령어 처리(OoOE): 명령어들을 순차적으로 실행하지 않는 기법

## CISC와 RISC

    CPU가 파이프라이닝과 슈퍼스칼라 기법을 효과적으로 사용하려면 CPU가 인출하고 해석하고
    실행하는 명령어가 파이프라이닝 하기 쉽게 생겨야 한다.
    파이프라이닝 하기 쉬운 명령어?
    CPU의 언어인 ISA와 각기 다른 성격의 ISA를 기반으로 설계된 CISC와 RISC를 알아보자

### 명령어 집합

    수많은 CPU 제조사들이 있고 CPU마다 규격과 기능이 다르기 때문에 명령어의 세세한 생김새, 명령어로 할 수 있는 연산,
    주소 지정 방식 등은 CPU마다 조금씩 차이가 있다.
    CPU가 이해할 수 있는 명령어들의 모음을 명령어 집합 또는 명령어 집합 구조(ISA)라고한다.
    같은 소스 코드로 만들어진 프로그램이라도 ISA가 다르면 CPU가 이해할 수 있는 명령어도 어셈블리어도 달라진다.

### CISC, RISC

| CISC                                 | RISC                                 |
| ------------------------------------ | ------------------------------------ |
| 복잡하고 다양한 명령어               | 단순하고 적은 명령어                 |
| 가변 길이 명령어                     | 고정 길이 명령어                     |
| 다양한 주소 지정 방식                | 적은 주소 지정 방식                  |
| 프로그램을 이루는 명령어의 수가 적음 | 프로그램을 이루는 명령어의 수가 많음 |
| 여러 클럭에 걸쳐 명령어 활용         | 1클럭 내외로 명령어 수행             |
| 파이프라이닝하기 어려움              | 파이프라이닝하기 쉬움                |
